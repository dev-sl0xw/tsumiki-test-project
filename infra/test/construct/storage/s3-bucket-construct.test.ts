/**
 * S3 Bucket Construct ãƒ†ã‚¹ãƒˆ
 *
 * TASK-0018: S3 + OAC Construct å®Ÿè£…
 * ãƒ•ã‚§ãƒ¼ã‚º: TDD Red Phase - å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä½œæˆ
 *
 * ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
 * - TC-S3-001: S3 ãƒã‚±ãƒƒãƒˆãƒªã‚½ãƒ¼ã‚¹ä½œæˆç¢ºèª
 * - TC-S3-002: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯è¨­å®šç¢ºèª (BlockPublicAcls)
 * - TC-S3-003: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯è¨­å®šç¢ºèª (å…¨è¨­å®š)
 * - TC-S3-004: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰æš—å·åŒ–è¨­å®šç¢ºèª
 * - TC-S3-005: ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æœ‰åŠ¹åŒ–ç¢ºèª
 * - TC-S3-006: ãƒã‚±ãƒƒãƒˆåå‘½åè¦å‰‡ç¢ºèª
 * - TC-S3-007: å‰Šé™¤ãƒãƒªã‚·ãƒ¼è¨­å®šç¢ºèª
 * - TC-OAC-001: OAC ãƒªã‚½ãƒ¼ã‚¹ä½œæˆç¢ºèª
 * - TC-OAC-002: OAC signingBehavior è¨­å®šç¢ºèª
 * - TC-OAC-003: OAC signingProtocol è¨­å®šç¢ºèª
 * - TC-OAC-004: OAC originType è¨­å®šç¢ºèª
 * - TC-OAC-005: OAC åå‘½åè¦å‰‡ç¢ºèª
 * - TC-BP-001: ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ä½œæˆç¢ºèª
 * - TC-BP-002: Principal è¨­å®šç¢ºèª
 * - TC-BP-003: Action è¨­å®šç¢ºèª
 * - TC-BP-004: Condition aws:SourceArn è¨­å®šç¢ºèª
 * - TC-BP-005: addCloudFrontBucketPolicy ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª
 * - TC-VAL-001: envName ç©ºæ–‡å­—ã‚¨ãƒ©ãƒ¼ç¢ºèª
 * - TC-VAL-002: envName é•·ã•è¶…éã‚¨ãƒ©ãƒ¼ç¢ºèª
 * - TC-VAL-003: envName ä¸æ­£æ–‡å­—ã‚¨ãƒ©ãƒ¼ç¢ºèª
 * - TC-VAL-004: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤é©ç”¨ç¢ºèª
 * - TC-VAL-005: versioned=false è¨­å®šç¢ºèª
 * - TC-VAL-006: bucketNameSuffix ã‚«ã‚¹ã‚¿ãƒ å€¤ç¢ºèª
 * - TC-PROP-001: bucket ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
 * - TC-PROP-002: bucketArn ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
 * - TC-PROP-003: bucketDomainName ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
 * - TC-PROP-004: originAccessControl ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
 * - TC-PROP-005: originAccessControlId ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
 * - TC-SNAP-001: CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç¢ºèª
 *
 * ğŸ”µ ä¿¡é ¼æ€§: è¦ä»¶å®šç¾©æ›¸ REQ-031, REQ-032, NFR-104 ã«åŸºã¥ããƒ†ã‚¹ãƒˆ
 *
 * @module s3-bucket-construct.test
 */

import * as cdk from 'aws-cdk-lib';
import { Template, Match } from 'aws-cdk-lib/assertions';
import { S3BucketConstruct } from '../../../lib/construct/storage/s3-bucket-construct';

describe('S3BucketConstruct', () => {
  // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆã§ç‹¬ç«‹ã—ãŸ CDK App ã¨ Stack ã‚’ä½œæˆ
  // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: å‰ã®ãƒ†ã‚¹ãƒˆã®çŠ¶æ…‹ãŒå½±éŸ¿ã—ãªã„ã‚ˆã†ã€æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
  let app: cdk.App;
  let stack: cdk.Stack;

  // ãƒ†ã‚¹ãƒˆç”¨å®šæ•°
  const TEST_ENV_NAME = 'test';
  const TEST_CLOUDFRONT_DISTRIBUTION_ARN =
    'arn:aws:cloudfront::123456789012:distribution/EXAMPLEID';

  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: CDK App ã¨ Stack ã‚’ä½œæˆ
    // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ
    app = new cdk.App();
    stack = new cdk.Stack(app, 'TestStack', {
      env: {
        account: '123456789012',
        region: 'ap-northeast-1',
      },
    });
  });

  afterEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå¾Œå‡¦ç†ã€‘: æ˜ç¤ºçš„ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¯ä¸è¦
    // ã€çŠ¶æ…‹å¾©å…ƒã€‘: Jest ãŒè‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆé–“ã®åˆ†é›¢ã‚’ä¿è¨¼
  });

  // ============================================================================
  // æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆS3 ãƒã‚±ãƒƒãƒˆä½œæˆï¼‰
  // ============================================================================

  describe('æ­£å¸¸ç³» - S3 ãƒã‚±ãƒƒãƒˆä½œæˆ', () => {
    // ============================================================================
    // TC-S3-001: S3 ãƒã‚±ãƒƒãƒˆãƒªã‚½ãƒ¼ã‚¹ä½œæˆç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-031 ã‚ˆã‚Š
    // ============================================================================
    describe('TC-S3-001: S3 ãƒã‚±ãƒƒãƒˆãƒªã‚½ãƒ¼ã‚¹ä½œæˆç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: S3BucketConstruct ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§æ­£å¸¸ã« S3 ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ã§ Construct ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: AWS::S3::Bucket ãƒªã‚½ãƒ¼ã‚¹ãŒ 1 ã¤ä½œæˆã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-031 ã‚ˆã‚Š

      test('S3 ãƒã‚±ãƒƒãƒˆãƒªã‚½ãƒ¼ã‚¹ãŒ 1 ã¤ä½œæˆã•ã‚Œã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ä½¿ç”¨
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: S3 ãƒã‚±ãƒƒãƒˆãƒªã‚½ãƒ¼ã‚¹ã®å­˜åœ¨ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: 1ã¤ã® S3 ãƒã‚±ãƒƒãƒˆãŒä½œæˆã•ã‚Œã‚‹ã“ã¨
        template.resourceCountIs('AWS::S3::Bucket', 1); // ã€ç¢ºèªå†…å®¹ã€‘: S3 ãƒã‚±ãƒƒãƒˆãŒ1ã¤å­˜åœ¨ã™ã‚‹ ğŸ”µ
      });
    });

    // ============================================================================
    // TC-S3-002: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯è¨­å®šç¢ºèª (BlockPublicAcls)
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-031, NFR-104 ã‚ˆã‚Š
    // ============================================================================
    describe('TC-S3-002: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯è¨­å®šç¢ºèª (BlockPublicAcls)', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: S3 ãƒã‚±ãƒƒãƒˆã® BlockPublicAcls è¨­å®šãŒ true ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: PublicAccessBlockConfiguration ã® BlockPublicAcls ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: BlockPublicAcls: true ãŒè¨­å®šã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-031, NFR-104 ã‚ˆã‚Š

      test('BlockPublicAcls ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯è¨­å®šã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: BlockPublicAcls ãŒ true ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::Bucket', {
          PublicAccessBlockConfiguration: Match.objectLike({
            BlockPublicAcls: true, // ã€ç¢ºèªå†…å®¹ã€‘: BlockPublicAcls ãŒæœ‰åŠ¹ ğŸ”µ
          }),
        });
      });
    });

    // ============================================================================
    // TC-S3-003: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯è¨­å®šç¢ºèª (å…¨è¨­å®š)
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-031, NFR-104 ã‚ˆã‚Š
    // ============================================================================
    describe('TC-S3-003: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯è¨­å®šç¢ºèª (å…¨è¨­å®š)', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: BlockPublicAccess.BLOCK_ALL ç›¸å½“ã®å…¨è¨­å®šãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: PublicAccessBlockConfiguration ã®å…¨ 4 é …ç›®ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: å…¨ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯è¨­å®šãŒ true
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-031, NFR-104 ã‚ˆã‚Š

      test('ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯å…¨è¨­å®šãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯å…¨è¨­å®šã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: å…¨ 4 é …ç›®ãŒ true ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::Bucket', {
          PublicAccessBlockConfiguration: {
            BlockPublicAcls: true, // ã€ç¢ºèªå†…å®¹ã€‘: BlockPublicAcls ãŒæœ‰åŠ¹ ğŸ”µ
            BlockPublicPolicy: true, // ã€ç¢ºèªå†…å®¹ã€‘: BlockPublicPolicy ãŒæœ‰åŠ¹ ğŸ”µ
            IgnorePublicAcls: true, // ã€ç¢ºèªå†…å®¹ã€‘: IgnorePublicAcls ãŒæœ‰åŠ¹ ğŸ”µ
            RestrictPublicBuckets: true, // ã€ç¢ºèªå†…å®¹ã€‘: RestrictPublicBuckets ãŒæœ‰åŠ¹ ğŸ”µ
          },
        });
      });
    });

    // ============================================================================
    // TC-S3-004: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰æš—å·åŒ–è¨­å®šç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-031 ã‚ˆã‚Š
    // ============================================================================
    describe('TC-S3-004: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰æš—å·åŒ–è¨­å®šç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: S3 ãƒã‚±ãƒƒãƒˆã« SSE-S3 (AES-256) æš—å·åŒ–ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: BucketEncryption ã®è¨­å®šã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: SSEAlgorithm: AES256 ãŒè¨­å®šã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-031 ã‚ˆã‚Š

      test('ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰æš—å·åŒ–ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: æš—å·åŒ–è¨­å®šã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: AES256 ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::Bucket', {
          BucketEncryption: {
            ServerSideEncryptionConfiguration: Match.arrayWith([
              Match.objectLike({
                ServerSideEncryptionByDefault: {
                  SSEAlgorithm: 'AES256', // ã€ç¢ºèªå†…å®¹ã€‘: AES256 æš—å·åŒ– ğŸ”µ
                },
              }),
            ]),
          },
        });
      });
    });

    // ============================================================================
    // TC-S3-005: ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æœ‰åŠ¹åŒ–ç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-031 ã‚ˆã‚Š
    // ============================================================================
    describe('TC-S3-005: ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æœ‰åŠ¹åŒ–ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: S3 ãƒã‚±ãƒƒãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: VersioningConfiguration ã®è¨­å®šã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: Status: Enabled ãŒè¨­å®šã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-031 ã‚ˆã‚Š

      test('ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°è¨­å®šã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: Status ãŒ Enabled ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::Bucket', {
          VersioningConfiguration: {
            Status: 'Enabled', // ã€ç¢ºèªå†…å®¹ã€‘: ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãŒæœ‰åŠ¹ ğŸ”µ
          },
        });
      });
    });

    // ============================================================================
    // TC-S3-006: ãƒã‚±ãƒƒãƒˆåå‘½åè¦å‰‡ç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: note.md å‘½åè¦ç´„ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
    // ============================================================================
    describe('TC-S3-006: ãƒã‚±ãƒƒãƒˆåå‘½åè¦å‰‡ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: S3 ãƒã‚±ãƒƒãƒˆåã«ç’°å¢ƒåãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: BucketName ã« envName ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒã‚±ãƒƒãƒˆåã«ç’°å¢ƒåãŒå«ã¾ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§: note.md å‘½åè¦ç´„ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

      test('ãƒã‚±ãƒƒãƒˆåãŒå‘½åè¦å‰‡ã«å¾“ã£ã¦ã„ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: envName='test' ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒã‚±ãƒƒãƒˆåã®å‘½åè¦å‰‡ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒã‚±ãƒƒãƒˆåã« 'test' ãŒå«ã¾ã‚Œã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::Bucket', {
          BucketName: Match.stringLikeRegexp('test'), // ã€ç¢ºèªå†…å®¹ã€‘: ç’°å¢ƒåãŒå«ã¾ã‚Œã‚‹ ğŸŸ¡
        });
      });
    });

    // ============================================================================
    // TC-S3-007: å‰Šé™¤ãƒãƒªã‚·ãƒ¼è¨­å®šç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: note.md ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
    // ============================================================================
    describe('TC-S3-007: å‰Šé™¤ãƒãƒªã‚·ãƒ¼è¨­å®šç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: S3 ãƒã‚±ãƒƒãƒˆã®å‰Šé™¤ãƒãƒªã‚·ãƒ¼ãŒæŒ‡å®šé€šã‚Šè¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: removalPolicy ã‚’æŒ‡å®šã—ã¦ DeletionPolicy ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: DeletionPolicy ãŒæŒ‡å®šé€šã‚Šè¨­å®šã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§: note.md ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

      test('é©åˆ‡ãªå‰Šé™¤ãƒãƒªã‚·ãƒ¼ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: removalPolicy=DESTROY ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
          removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: å‰Šé™¤ãƒãƒªã‚·ãƒ¼ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: DeletionPolicy ãŒ Delete ã§ã‚ã‚‹ã“ã¨
        const buckets = template.findResources('AWS::S3::Bucket');
        const bucketKeys = Object.keys(buckets);
        expect(bucketKeys.length).toBeGreaterThan(0);
        expect(buckets[bucketKeys[0]].DeletionPolicy).toBe('Delete'); // ã€ç¢ºèªå†…å®¹ã€‘: å‰Šé™¤ãƒãƒªã‚·ãƒ¼ ğŸŸ¡
      });
    });
  });

  // ============================================================================
  // OAC è¨­å®šãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
  // ============================================================================

  describe('OAC è¨­å®šãƒ†ã‚¹ãƒˆ', () => {
    // ============================================================================
    // TC-OAC-001: OAC ãƒªã‚½ãƒ¼ã‚¹ä½œæˆç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-032 ã‚ˆã‚Š
    // ============================================================================
    describe('TC-OAC-001: OAC ãƒªã‚½ãƒ¼ã‚¹ä½œæˆç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: CloudFront Origin Access Control ãƒªã‚½ãƒ¼ã‚¹ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: AWS::CloudFront::OriginAccessControl ãƒªã‚½ãƒ¼ã‚¹ã®å­˜åœ¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: OAC ãƒªã‚½ãƒ¼ã‚¹ãŒ 1 ã¤ä½œæˆã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-032 ã‚ˆã‚Š

      test('OAC ãƒªã‚½ãƒ¼ã‚¹ãŒ 1 ã¤ä½œæˆã•ã‚Œã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: OAC ãƒªã‚½ãƒ¼ã‚¹ã®å­˜åœ¨ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: 1ã¤ã® OAC ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨
        template.resourceCountIs('AWS::CloudFront::OriginAccessControl', 1); // ã€ç¢ºèªå†…å®¹ã€‘: OAC ãŒ1ã¤å­˜åœ¨ã™ã‚‹ ğŸ”µ
      });
    });

    // ============================================================================
    // TC-OAC-002: OAC signingBehavior è¨­å®šç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-032 ã‚ˆã‚Š
    // ============================================================================
    describe('TC-OAC-002: OAC signingBehavior è¨­å®šç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: OAC ã® signingBehavior ãŒ 'always' ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: OriginAccessControlConfig ã® SigningBehavior ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: SigningBehavior: 'always' ãŒè¨­å®šã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-032 ã‚ˆã‚Š

      test('signingBehavior ãŒ always ã§ã‚ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: signingBehavior ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: SigningBehavior ãŒ 'always' ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::CloudFront::OriginAccessControl', {
          OriginAccessControlConfig: Match.objectLike({
            SigningBehavior: 'always', // ã€ç¢ºèªå†…å®¹ã€‘: å¸¸ã«ç½²å ğŸ”µ
          }),
        });
      });
    });

    // ============================================================================
    // TC-OAC-003: OAC signingProtocol è¨­å®šç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-032 ã‚ˆã‚Š
    // ============================================================================
    describe('TC-OAC-003: OAC signingProtocol è¨­å®šç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: OAC ã® signingProtocol ãŒ 'sigv4' ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: OriginAccessControlConfig ã® SigningProtocol ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: SigningProtocol: 'sigv4' ãŒè¨­å®šã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-032 ã‚ˆã‚Š

      test('signingProtocol ãŒ sigv4 ã§ã‚ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: signingProtocol ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: SigningProtocol ãŒ 'sigv4' ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::CloudFront::OriginAccessControl', {
          OriginAccessControlConfig: Match.objectLike({
            SigningProtocol: 'sigv4', // ã€ç¢ºèªå†…å®¹ã€‘: SigV4 ç½²å ğŸ”µ
          }),
        });
      });
    });

    // ============================================================================
    // TC-OAC-004: OAC originType è¨­å®šç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: OAC for S3 ã®æ¨™æº–è¨­å®š
    // ============================================================================
    describe('TC-OAC-004: OAC originType è¨­å®šç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: OAC ã® Origin Type ãŒ 's3' ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: OriginAccessControlConfig ã® OriginAccessControlOriginType ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: OriginAccessControlOriginType: 's3' ãŒè¨­å®šã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: OAC for S3 ã®æ¨™æº–è¨­å®š

      test('originAccessControlOriginType ãŒ s3 ã§ã‚ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: originType ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: OriginAccessControlOriginType ãŒ 's3' ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::CloudFront::OriginAccessControl', {
          OriginAccessControlConfig: Match.objectLike({
            OriginAccessControlOriginType: 's3', // ã€ç¢ºèªå†…å®¹ã€‘: S3 ã‚ªãƒªã‚¸ãƒ³ã‚¿ã‚¤ãƒ— ğŸ”µ
          }),
        });
      });
    });

    // ============================================================================
    // TC-OAC-005: OAC åå‘½åè¦å‰‡ç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: note.md å‘½åè¦ç´„ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
    // ============================================================================
    describe('TC-OAC-005: OAC åå‘½åè¦å‰‡ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: OAC ã®åå‰ã«ç’°å¢ƒåãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: OriginAccessControlConfig.Name ã« envName ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: OAC åã«ç’°å¢ƒåãŒå«ã¾ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§: note.md å‘½åè¦ç´„ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

      test('OAC åãŒå‘½åè¦å‰‡ã«å¾“ã£ã¦ã„ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: envName='test' ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: OAC åã®å‘½åè¦å‰‡ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: OAC åã« 'test' ãŒå«ã¾ã‚Œã‚‹ã“ã¨
        template.hasResourceProperties('AWS::CloudFront::OriginAccessControl', {
          OriginAccessControlConfig: Match.objectLike({
            Name: Match.stringLikeRegexp('test'), // ã€ç¢ºèªå†…å®¹ã€‘: ç’°å¢ƒåãŒå«ã¾ã‚Œã‚‹ ğŸŸ¡
          }),
        });
      });
    });
  });

  // ============================================================================
  // ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
  // ============================================================================

  describe('ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ãƒ†ã‚¹ãƒˆ', () => {
    // ============================================================================
    // TC-BP-001: ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ä½œæˆç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-032 ã‚ˆã‚Š
    // ============================================================================
    describe('TC-BP-001: ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ä½œæˆç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: S3 ãƒã‚±ãƒƒãƒˆã«ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: AWS::S3::BucketPolicy ãƒªã‚½ãƒ¼ã‚¹ã®å­˜åœ¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: BucketPolicy ãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-032 ã‚ˆã‚Š

      test('ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: cloudFrontDistributionArn æŒ‡å®šã§ S3BucketConstruct ã‚’ä½œæˆ
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });

        // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: addCloudFrontBucketPolicy ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—
        s3Construct.addCloudFrontBucketPolicy(TEST_CLOUDFRONT_DISTRIBUTION_ARN);

        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã®å­˜åœ¨ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: BucketPolicy ãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨
        template.resourceCountIs('AWS::S3::BucketPolicy', 1); // ã€ç¢ºèªå†…å®¹ã€‘: BucketPolicy ãŒ1ã¤å­˜åœ¨ã™ã‚‹ ğŸ”µ
      });
    });

    // ============================================================================
    // TC-BP-002: Principal è¨­å®šç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-032ã€OAC æ¨™æº–è¨­å®šã‚ˆã‚Š
    // ============================================================================
    describe('TC-BP-002: Principal è¨­å®šç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã® Principal ãŒ CloudFront ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: Statement ã® Principal.Service ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: Principal ãŒ cloudfront.amazonaws.com
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-032ã€OAC æ¨™æº–è¨­å®šã‚ˆã‚Š

      test('Principal ãŒ cloudfront.amazonaws.com ã§ã‚ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: S3BucketConstruct ã‚’ä½œæˆã—ã¦ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ 
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        s3Construct.addCloudFrontBucketPolicy(TEST_CLOUDFRONT_DISTRIBUTION_ARN);

        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: Principal ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: Service Principal ãŒ cloudfront.amazonaws.com ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::BucketPolicy', {
          PolicyDocument: {
            Statement: Match.arrayWith([
              Match.objectLike({
                Principal: {
                  Service: 'cloudfront.amazonaws.com', // ã€ç¢ºèªå†…å®¹ã€‘: CloudFront ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ« ğŸ”µ
                },
              }),
            ]),
          },
        });
      });
    });

    // ============================================================================
    // TC-BP-003: Action è¨­å®šç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-032ã€OAC æ¨™æº–è¨­å®šã‚ˆã‚Š
    // ============================================================================
    describe('TC-BP-003: Action è¨­å®šç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã® Action ãŒ s3:GetObject ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: Statement ã® Action ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: Action ãŒ s3:GetObject
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-032ã€OAC æ¨™æº–è¨­å®šã‚ˆã‚Š

      test('Action ãŒ s3:GetObject ã§ã‚ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: S3BucketConstruct ã‚’ä½œæˆã—ã¦ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ 
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        s3Construct.addCloudFrontBucketPolicy(TEST_CLOUDFRONT_DISTRIBUTION_ARN);

        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: Action ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: Action ãŒ s3:GetObject ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::BucketPolicy', {
          PolicyDocument: {
            Statement: Match.arrayWith([
              Match.objectLike({
                Action: 's3:GetObject', // ã€ç¢ºèªå†…å®¹ã€‘: GetObject ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ğŸ”µ
              }),
            ]),
          },
        });
      });
    });

    // ============================================================================
    // TC-BP-004: Condition aws:SourceArn è¨­å®šç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: REQ-032ã€OAC æ¨™æº–è¨­å®šã‚ˆã‚Š
    // ============================================================================
    describe('TC-BP-004: Condition aws:SourceArn è¨­å®šç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã« CloudFront Distribution ARN ã®æ¡ä»¶ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: Condition ã® StringEquals.'aws:SourceArn' ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: Condition ã« aws:SourceArn ãŒè¨­å®šã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: REQ-032ã€OAC æ¨™æº–è¨­å®šã‚ˆã‚Š

      test('Condition ã§ aws:SourceArn ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: S3BucketConstruct ã‚’ä½œæˆã—ã¦ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ 
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        s3Construct.addCloudFrontBucketPolicy(TEST_CLOUDFRONT_DISTRIBUTION_ARN);

        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: Condition ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: aws:SourceArn ãŒæŒ‡å®šã—ãŸ ARN ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::BucketPolicy', {
          PolicyDocument: {
            Statement: Match.arrayWith([
              Match.objectLike({
                Condition: {
                  StringEquals: {
                    'aws:SourceArn': TEST_CLOUDFRONT_DISTRIBUTION_ARN, // ã€ç¢ºèªå†…å®¹ã€‘: CloudFront ARN æ¡ä»¶ ğŸ”µ
                  },
                },
              }),
            ]),
          },
        });
      });
    });

    // ============================================================================
    // TC-BP-005: addCloudFrontBucketPolicy ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š
    // ============================================================================
    describe('TC-BP-005: addCloudFrontBucketPolicy ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: cloudFrontDistributionArn ãªã—ã§ä½œæˆå¾Œã€å¾Œã‹ã‚‰ãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: addCloudFrontBucketPolicy() ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒãƒªã‚·ãƒ¼è¿½åŠ ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒãƒªã‚·ãƒ¼ãŒæ­£å¸¸ã«è¿½åŠ ã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š

      test('addCloudFrontBucketPolicy ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒãƒªã‚·ãƒ¼ãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: cloudFrontDistributionArn ãªã—ã§ S3BucketConstruct ã‚’ä½œæˆ
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });

        // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: addCloudFrontBucketPolicy ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—
        s3Construct.addCloudFrontBucketPolicy(TEST_CLOUDFRONT_DISTRIBUTION_ARN);

        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒãƒªã‚·ãƒ¼è¿½åŠ ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: BucketPolicy ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
        template.resourceCountIs('AWS::S3::BucketPolicy', 1); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒãƒªã‚·ãƒ¼ãŒè¿½åŠ ã•ã‚ŒãŸ ğŸ”µ
      });
    });

    // ============================================================================
    // TC-BP-006: addCloudFrontBucketPolicy ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§è¿½åŠ ã•ã‚ŒãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    // ============================================================================
    describe('TC-BP-006: addCloudFrontBucketPolicy ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: distributionArn ãŒç©ºã®å ´åˆã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ç©ºæ–‡å­—åˆ—ã§ addCloudFrontBucketPolicy ã‚’å‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§è¿½åŠ ã•ã‚ŒãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

      test('distributionArn ãŒç©ºã®å ´åˆã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: S3BucketConstruct ã‚’ä½œæˆ
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });

        // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ç©ºã® distributionArn ã§ãƒãƒªã‚·ãƒ¼è¿½åŠ ã‚’è©¦è¡Œ
        // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
        expect(() => {
          s3Construct.addCloudFrontBucketPolicy('');
        }).toThrow('distributionArn ã¯å¿…é ˆã§ã™ã€‚ç©ºæ–‡å­—åˆ—ã¯æŒ‡å®šã§ãã¾ã›ã‚“ã€‚'); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ ğŸŸ¡
      });
    });
  });

  // ============================================================================
  // Props ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆç•°å¸¸ç³»ï¼‰
  // ============================================================================

  describe('Props ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ', () => {
    // ============================================================================
    // TC-VAL-001: envName ç©ºæ–‡å­—ã‚¨ãƒ©ãƒ¼ç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: æ—¢å­˜ Construct ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
    // ============================================================================
    describe('TC-VAL-001: envName ç©ºæ–‡å­—ã‚¨ãƒ©ãƒ¼ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: envName ã«ç©ºæ–‡å­—ã‚’æŒ‡å®šã—ãŸå ´åˆã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: envName='' ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§: æ—¢å­˜ Construct ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

      test('envName ãŒç©ºã®å ´åˆã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: envName='' ã§ S3BucketConstruct ã‚’ä½œæˆ
        // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
        expect(() => {
          new S3BucketConstruct(stack, 'TestS3Bucket', {
            envName: '',
          });
        }).toThrow(); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ ğŸŸ¡
      });
    });

    // ============================================================================
    // TC-VAL-002: envName é•·ã•è¶…éã‚¨ãƒ©ãƒ¼ç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: S3 ãƒã‚±ãƒƒãƒˆåã®åˆ¶é™ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
    // ============================================================================
    describe('TC-VAL-002: envName é•·ã•è¶…éã‚¨ãƒ©ãƒ¼ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: envName ãŒåˆ¶é™é•·ã‚’è¶…ãˆãŸå ´åˆã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: envName ãŒ 64 æ–‡å­—ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§: S3 ãƒã‚±ãƒƒãƒˆåã®åˆ¶é™ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

      test('envName ãŒé•·ã™ãã‚‹å ´åˆã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: é•·ã™ãã‚‹ envName ã§ S3BucketConstruct ã‚’ä½œæˆ
        // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
        expect(() => {
          new S3BucketConstruct(stack, 'TestS3Bucket', {
            envName: 'a'.repeat(64),
          });
        }).toThrow(); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ ğŸŸ¡
      });
    });

    // ============================================================================
    // TC-VAL-003: envName ä¸æ­£æ–‡å­—ã‚¨ãƒ©ãƒ¼ç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: S3 ãƒã‚±ãƒƒãƒˆåã®åˆ¶é™ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
    // ============================================================================
    describe('TC-VAL-003: envName ä¸æ­£æ–‡å­—ã‚¨ãƒ©ãƒ¼ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: envName ã«ä¸æ­£ãªæ–‡å­—ãŒå«ã¾ã‚Œã‚‹å ´åˆã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€ envName ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§: S3 ãƒã‚±ãƒƒãƒˆåã®åˆ¶é™ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

      test('envName ãŒä¸æ­£ãªå½¢å¼ã®å ´åˆã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ä¸æ­£æ–‡å­—ã‚’å«ã‚€ envName ã§ S3BucketConstruct ã‚’ä½œæˆ
        // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹
        expect(() => {
          new S3BucketConstruct(stack, 'TestS3Bucket', {
            envName: 'test_env!',
          });
        }).toThrow(); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ ğŸŸ¡
      });
    });

    // ============================================================================
    // TC-VAL-004: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤é©ç”¨ç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: note.md Props ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
    // ============================================================================
    describe('TC-VAL-004: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤é©ç”¨ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’çœç•¥ã—ãŸå ´åˆã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒé©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: versioned=true, bucketNameSuffix='static-content' ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé©ç”¨
      // ğŸŸ¡ ä¿¡é ¼æ€§: note.md Props ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

      test('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒæ­£ã—ãé©ç”¨ã•ã‚Œã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: versioned ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ true ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::Bucket', {
          VersioningConfiguration: {
            Status: 'Enabled', // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æœ‰åŠ¹ ğŸŸ¡
          },
        });

        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: bucketNameSuffix ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ 'static-content' ã§ã‚ã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::Bucket', {
          BucketName: Match.stringLikeRegexp('static-content'), // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ ğŸŸ¡
        });
      });
    });

    // ============================================================================
    // TC-VAL-005: versioned=false è¨­å®šç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: note.md Props ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
    // ============================================================================
    describe('TC-VAL-005: versioned=false è¨­å®šç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: versioned ã‚’ false ã«è¨­å®šã—ãŸå ´åˆã«ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãŒç„¡åŠ¹ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: versioned=false ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€VersioningConfiguration ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãŒæœªè¨­å®šã¾ãŸã¯ Suspended
      // ğŸŸ¡ ä¿¡é ¼æ€§: note.md Props ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

      test('versioned=false ãŒæ­£ã—ãåæ˜ ã•ã‚Œã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: versioned=false ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
          versioned: false,
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ç„¡åŠ¹ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: VersioningConfiguration ãŒæœªè¨­å®šã¾ãŸã¯ Suspended ã§ã‚ã‚‹ã“ã¨
        const buckets = template.findResources('AWS::S3::Bucket');
        const bucketKeys = Object.keys(buckets);
        expect(bucketKeys.length).toBeGreaterThan(0);

        const versioningConfig = buckets[bucketKeys[0]].Properties?.VersioningConfiguration;
        // ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãŒç„¡åŠ¹ã®å ´åˆã€æœªè¨­å®šã¾ãŸã¯ Status ãŒ Suspended
        if (versioningConfig) {
          expect(versioningConfig.Status).not.toBe('Enabled'); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ç„¡åŠ¹ ğŸŸ¡
        }
      });
    });

    // ============================================================================
    // TC-VAL-006: bucketNameSuffix ã‚«ã‚¹ã‚¿ãƒ å€¤ç¢ºèª
    // ğŸŸ¡ ä¿¡é ¼æ€§: note.md Props ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
    // ============================================================================
    describe('TC-VAL-006: bucketNameSuffix ã‚«ã‚¹ã‚¿ãƒ å€¤ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: bucketNameSuffix ã‚’ã‚«ã‚¹ã‚¿ãƒ å€¤ã§è¨­å®šã—ãŸå ´åˆã«ãƒã‚±ãƒƒãƒˆåã«åæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: bucketNameSuffix='custom-assets' ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€BucketName ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒãƒã‚±ãƒƒãƒˆåã«åæ˜ ã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§: note.md Props ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬

      test('bucketNameSuffix ãŒæ­£ã—ãåæ˜ ã•ã‚Œã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: bucketNameSuffix='custom-assets' ã§ S3BucketConstruct ã‚’ä½œæˆ
        new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
          bucketNameSuffix: 'custom-assets',
        });
        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: BucketName ã« 'custom-assets' ãŒå«ã¾ã‚Œã‚‹ã“ã¨
        template.hasResourceProperties('AWS::S3::Bucket', {
          BucketName: Match.stringLikeRegexp('custom-assets'), // ã€ç¢ºèªå†…å®¹ã€‘: ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ ğŸŸ¡
        });
      });
    });
  });

  // ============================================================================
  // å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
  // ============================================================================

  describe('å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ†ã‚¹ãƒˆ', () => {
    // ============================================================================
    // TC-PROP-001: bucket ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š
    // ============================================================================
    describe('TC-PROP-001: bucket ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: Construct ã‹ã‚‰ bucket ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: bucket ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: bucket ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ undefined ã§ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š

      test('bucket ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: bucket ãŒ undefined ã§ãªã„ã“ã¨
        expect(s3Construct.bucket).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: bucket ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ ğŸ”µ
      });
    });

    // ============================================================================
    // TC-PROP-002: bucketArn ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š
    // ============================================================================
    describe('TC-PROP-002: bucketArn ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: Construct ã‹ã‚‰ bucketArn ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: bucketArn ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: bucketArn ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ undefined ã§ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š

      test('bucketArn ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: bucketArn ãŒ undefined ã§ãªã„ã“ã¨
        expect(s3Construct.bucketArn).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: bucketArn ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ ğŸ”µ
      });
    });

    // ============================================================================
    // TC-PROP-003: bucketDomainName ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š
    // ============================================================================
    describe('TC-PROP-003: bucketDomainName ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: Construct ã‹ã‚‰ bucketDomainName ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: bucketDomainName ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: bucketDomainName ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ undefined ã§ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š

      test('bucketDomainName ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: bucketDomainName ãŒ undefined ã§ãªã„ã“ã¨
        expect(s3Construct.bucketDomainName).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: bucketDomainName ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ ğŸ”µ
      });
    });

    // ============================================================================
    // TC-PROP-004: originAccessControl ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š
    // ============================================================================
    describe('TC-PROP-004: originAccessControl ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: Construct ã‹ã‚‰ originAccessControl ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: originAccessControl ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: originAccessControl ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ undefined ã§ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š

      test('originAccessControl ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: originAccessControl ãŒ undefined ã§ãªã„ã“ã¨
        expect(s3Construct.originAccessControl).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: originAccessControl ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ ğŸ”µ
      });
    });

    // ============================================================================
    // TC-PROP-005: originAccessControlId ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š
    // ============================================================================
    describe('TC-PROP-005: originAccessControlId ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: Construct ã‹ã‚‰ originAccessControlId ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: originAccessControlId ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: originAccessControlId ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ undefined ã§ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§: note.md è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š

      test('originAccessControlId ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ S3BucketConstruct ã‚’ä½œæˆ
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
        });

        // ã€çµæœæ¤œè¨¼ã€‘: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: originAccessControlId ãŒ undefined ã§ãªã„ã“ã¨
        expect(s3Construct.originAccessControlId).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: originAccessControlId ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ ğŸ”µ
      });
    });
  });

  // ============================================================================
  // ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
  // ============================================================================

  describe('ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ', () => {
    // ============================================================================
    // TC-SNAP-001: CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç¢ºèª
    // ğŸ”µ ä¿¡é ¼æ€§: CDK ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚ˆã‚Š
    // ============================================================================
    describe('TC-SNAP-001: CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç¢ºèª', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ç”Ÿæˆã•ã‚Œã‚‹ CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨ä¸€è‡´ã™ã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§: CDK ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚ˆã‚Š

      test('CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨ä¸€è‡´ã™ã‚‹ã“ã¨', () => {
        // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å…¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³æŒ‡å®šã§ S3BucketConstruct ã‚’ä½œæˆ
        const s3Construct = new S3BucketConstruct(stack, 'TestS3Bucket', {
          envName: TEST_ENV_NAME,
          bucketNameSuffix: 'static-content',
          versioned: true,
          removalPolicy: cdk.RemovalPolicy.RETAIN,
        });

        // CloudFront Distribution ARN ã‚’è¨­å®šã—ã¦ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ 
        s3Construct.addCloudFrontBucketPolicy(TEST_CLOUDFRONT_DISTRIBUTION_ARN);

        const template = Template.fromStack(stack);

        // ã€çµæœæ¤œè¨¼ã€‘: ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨ã®æ¯”è¼ƒ
        // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒä»¥å‰ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨ä¸€è‡´ã™ã‚‹ã“ã¨
        expect(template.toJSON()).toMatchSnapshot(); // ã€ç¢ºèªå†…å®¹ã€‘: CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ ğŸ”µ
      });
    });
  });
});
