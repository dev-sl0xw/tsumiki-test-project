# TASK-0017: Application Stack çµ±åˆ âœ… **å®Œäº†** (TDDé–‹ç™ºå®Œäº† - 50ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šé)

**ã‚¿ã‚¹ã‚¯ID**: TASK-0017
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 6æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 3 - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ãƒ»è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **TDDé–‹ç™ºå®Œäº†** (2026-02-01)

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/aws-cdk-serverless-architecture/requirements.md) - REQ-012~021, REQ-028~030
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/aws-cdk-serverless-architecture/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

ECS Cluster, Task Definition, Service, ALB ã®å„ Construct ã‚’ Application Stack ã«çµ±åˆã—ã¾ã™ã€‚ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å«ã‚€åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã§å“è³ªã‚’ç¢ºä¿ã—ã¾ã™ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0015](TASK-0015.md) - ECS Service Construct å®Ÿè£…, [TASK-0016](TASK-0016.md) - ALB Construct å®Ÿè£…
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: Phase 4 ã‚¿ã‚¹ã‚¯

## å®Œäº†æ¡ä»¶

- [x] Application Stack ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã‚‹ã“ã¨ âœ…
- [x] ECS Cluster ãŒçµ±åˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ âœ…
- [x] Task Definition ãŒçµ±åˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ âœ…
- [x] Frontend/Backend Service ãŒçµ±åˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ âœ…
- [x] ALB ãŒçµ±åˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ âœ…
- [x] å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ âœ…
- [x] ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ âœ…
- [x] çµ±åˆãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ âœ…

---

## ä¸»è¦å®Ÿè£…é …ç›®

### Application Stack ä½œæˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

Application ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ±åˆã™ã‚‹ Stack ã‚’ä½œæˆã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/stack/application-stack.ts`

```typescript
import * as cdk from 'aws-cdk-lib';
import { EcsClusterConstruct } from '../construct/ecs-cluster-construct';
import { TaskDefinitionConstruct } from '../construct/task-definition-construct';
import { EcsServiceConstruct } from '../construct/ecs-service-construct';
import { AlbConstruct } from '../construct/alb-construct';

export class ApplicationStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props: ApplicationStackProps) {
    super(scope, id, props);

    // ECS Cluster
    const cluster = new EcsClusterConstruct(this, 'Cluster', {
      vpc: props.vpc,
      projectName: props.projectName,
    });

    // Task Definitions
    const frontendTaskDef = new TaskDefinitionConstruct(this, 'FrontendTaskDef', {
      // ...
    });

    const backendTaskDef = new TaskDefinitionConstruct(this, 'BackendTaskDef', {
      // ...
    });

    // Services
    const frontendService = new EcsServiceConstruct(this, 'FrontendService', {
      cluster: cluster.cluster,
      taskDefinition: frontendTaskDef.taskDefinition,
      serviceName: 'frontend',
    });

    const backendService = new EcsServiceConstruct(this, 'BackendService', {
      cluster: cluster.cluster,
      taskDefinition: backendTaskDef.taskDefinition,
      serviceName: 'backend',
    });

    // ALB
    const alb = new AlbConstruct(this, 'ALB', {
      vpc: props.vpc,
      certificate: props.certificate,
      ecsService: frontendService.service,
    });
  }
}
```

### Stack Props ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾© ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

Application Stack ã® Props ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/stack/application-stack.ts`

```typescript
export interface ApplicationStackProps extends cdk.StackProps {
  projectName: string;
  vpc: ec2.IVpc;
  certificate: acm.ICertificate;
  appRepositoryArn: string;
  sidecarRepositoryArn: string;
  secretArn: string;
}
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ä¾å­˜é–¢ä¿‚è¨­å®š ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚ã‚’æ­£ã—ãè¨­å®šã—ã€ãƒ‡ãƒ—ãƒ­ã‚¤é †åºã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/stack/application-stack.ts`

### CloudFormation å‡ºåŠ›è¨­å®š ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

ALB DNS åãªã©ã®é‡è¦ãªå€¤ã‚’ CloudFormation å‡ºåŠ›ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/stack/application-stack.ts`

```typescript
new cdk.CfnOutput(this, 'AlbDnsName', {
  value: alb.loadBalancer.loadBalancerDnsName,
  description: 'ALB DNS Name',
  exportName: `${props.projectName}-alb-dns`,
});
```

---

## åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆè¦ä»¶

### Stack ä½œæˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

- Application Stack ãŒæ­£å¸¸ã«ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚ºã•ã‚Œã‚‹ã“ã¨
- å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ãŒã™ã¹ã¦å«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-012~021, REQ-028~030 ã‚ˆã‚Š*

- ECS Cluster ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- Task Definition ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ECS Service ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ALB ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã“ã¨

### ä¾å­˜é–¢ä¿‚ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

- Service ãŒ Cluster ã«ä¾å­˜ã—ã¦ã„ã‚‹ã“ã¨
- Service ãŒ Task Definition ã«ä¾å­˜ã—ã¦ã„ã‚‹ã“ã¨
- ALB Target Group ãŒ Service ã«ä¾å­˜ã—ã¦ã„ã‚‹ã“ã¨

### ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

- CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæœŸå¾…é€šã‚Šã«ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨
- ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãŒæ¤œå‡ºã§ãã‚‹ã“ã¨

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- IAM ãƒ­ãƒ¼ãƒ«ãŒæœ€å°æ¨©é™ã®åŸå‰‡ã«å¾“ã£ã¦ã„ã‚‹ã“ã¨

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ

1. `/tsumiki:tdd-requirements TASK-0017` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 9é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 9é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
