# TASK-0010: Database Stack çµ±åˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0010
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/aws-cdk-serverless-architecture/requirements.md) - REQ-022, REQ-023, REQ-024, REQ-025, REQ-026, REQ-027
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/aws-cdk-serverless-architecture/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

Aurora Construct ã¨ Secrets Manager Construct ã‚’çµ±åˆã—ãŸ Database Stack ã‚’æ§‹æˆã—ã¾ã™ã€‚VPC Stackã€Security Stack ã‹ã‚‰ã®ä¾å­˜é–¢ä¿‚ç®¡ç†ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ãƒªã‚½ãƒ¼ã‚¹ã®ä¸€å…ƒç®¡ç†ã€ä»–ã‚¹ã‚¿ãƒƒã‚¯ã¸ã®ãƒªã‚½ãƒ¼ã‚¹ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0008](TASK-0008.md) Aurora Construct å®Ÿè£…, [TASK-0009](TASK-0009.md) Secrets Manager çµ±åˆ
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: Phase 3 - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‚¿ã‚¹ã‚¯

## å®Œäº†æ¡ä»¶

- [ ] Database Stack ãŒ VPC Stackã€Security Stack ã‹ã‚‰ã®ä¾å­˜é–¢ä¿‚ã‚’æ­£ã—ãè§£æ±ºã—ã¦ã„ã‚‹
- [ ] Aurora Construct ã¨ Secrets Manager Construct ãŒçµ±åˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ãŒé©åˆ‡ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹
- [ ] ã™ã¹ã¦ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒé€šéã—ã¦ã„ã‚‹
- [ ] cdk synth ã§ã‚¨ãƒ©ãƒ¼ãªã CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹

---

## ä¸»è¦å®Ÿè£…é …ç›®

### Database Stack å®šç¾© ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *CDK ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹*

Aurora ã¨ Secrets Manager ã‚’çµ±åˆã—ãŸ Database Stack ã‚’å®Ÿè£…ã—ã¾ã™ã€‚VPC Stackã€Security Stack ã‹ã‚‰ã®å‚ç…§ã‚’å—ã‘å–ã‚Šã€Application Stack ã¸ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```typescript
export interface DatabaseStackProps extends cdk.StackProps {
  vpc: ec2.IVpc;
  auroraSecurityGroup: ec2.ISecurityGroup;
  envName: string;
}

export class DatabaseStack extends cdk.Stack {
  public readonly auroraCluster: rds.IDatabaseCluster;
  public readonly dbSecret: secretsmanager.ISecret;
  public readonly dbEndpoint: string;
  public readonly dbPort: number;
}
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/stack/database-stack.ts`

### ã‚¹ã‚¿ãƒƒã‚¯é–“ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *CDK ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹*

CfnOutput ã‚’ä½¿ç”¨ã—ãŸã‚¹ã‚¿ãƒƒã‚¯é–“ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã®å®Ÿè£…ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ãƒãƒ¼ãƒˆç•ªå·ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ ARN ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’è¡Œã„ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/stack/database-stack.ts`

### Construct çµ±åˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã«åŸºã¥ã*

Aurora Construct ã¨ Secrets Manager Construct ã®é©åˆ‡ãªçµ„ã¿åˆã‚ã›ã€‚ä¾å­˜é–¢ä¿‚ã®é †åºåˆ¶å¾¡ã€ãƒªã‚½ãƒ¼ã‚¹é–“ã®å‚ç…§è¨­å®šã‚’å«ã¿ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/stack/database-stack.ts`

---

## åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆè¦ä»¶

### Database Stack ç”Ÿæˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *CDK ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³*

- Database Stack ãŒæ­£å¸¸ã«åˆæˆã§ãã‚‹ã“ã¨
- å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ï¼ˆAurora ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã€Secrets Manager ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨

### ã‚¹ã‚¿ãƒƒã‚¯ä¾å­˜é–¢ä¿‚ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *CDK ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³*

- VPC Stack ã¸ã®ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- Security Stack ã¸ã®ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨

### ãƒªã‚½ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *CDK ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³*

- Aurora ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒ Secrets Manager ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨æ­£ã—ãçµ±åˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- Security Group ãŒé©åˆ‡ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ

1. `/tsumiki:tdd-requirements TASK-0010` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 6é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 6é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
