# TASK-0015: ECS Service Construct å®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0015
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 6æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 3 - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ãƒ»è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/aws-cdk-serverless-architecture/requirements.md) - REQ-019, REQ-020, REQ-021
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/aws-cdk-serverless-architecture/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

ECS Fargate Service Construct ã‚’å®Ÿè£…ã—ã¾ã™ã€‚Frontend ã¨ Backend ã®ä¸¡ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾å¿œã—ã€enableExecuteCommand ã«ã‚ˆã‚‹ ECS Exec æ©Ÿèƒ½ã¨ Desired Count 2 ã«ã‚ˆã‚‹å¯ç”¨æ€§ç¢ºä¿ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0014](TASK-0014.md) - Task Definition Construct å®Ÿè£…
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: [TASK-0016](TASK-0016.md) - ALB Construct å®Ÿè£…, [TASK-0017](TASK-0017.md) - Application Stack çµ±åˆ

## å®Œäº†æ¡ä»¶

- [x] ECS Service Construct ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã‚‹ã“ã¨
- [x] Frontend Service ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆæ±ç”¨ Service Construct ã¨ã—ã¦å®Ÿè£…ï¼‰
- [x] Backend Service ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆæ±ç”¨ Service Construct ã¨ã—ã¦å®Ÿè£…ï¼‰
- [x] enableExecuteCommand ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [x] Desired Count ãŒ 2 ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [x] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒã™ã¹ã¦ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ï¼ˆ19/19 ãƒ†ã‚¹ãƒˆæˆåŠŸï¼‰
- [x] ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨

---

## ä¸»è¦å®Ÿè£…é …ç›®

### Fargate Service ä½œæˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-019 ã‚ˆã‚Š*

ECS Fargate Service ã‚’ä½œæˆã—ã¾ã™ã€‚Private Subnet ã«é…ç½®ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’è¡Œã„ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/ecs-service-construct.ts`

```typescript
import * as ecs from 'aws-cdk-lib/aws-ecs';

const service = new ecs.FargateService(this, 'Service', {
  cluster: props.cluster,
  taskDefinition: props.taskDefinition,
  desiredCount: 2,
  enableExecuteCommand: true,
  vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
  securityGroups: [props.securityGroup],
  serviceName: `${props.projectName}-${props.serviceName}`,
});
```

### ECS Exec æœ‰åŠ¹åŒ– ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-020 ã‚ˆã‚Š*

enableExecuteCommand ã‚’æœ‰åŠ¹åŒ–ã—ã€ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ãƒ‡ãƒãƒƒã‚°ã‚„ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ä½¿ç”¨ã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/ecs-service-construct.ts`

```typescript
// enableExecuteCommand: true ã«ã‚ˆã‚Šä»¥ä¸‹ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã‚‹
// - SSM Session Manager çµŒç”±ã§ã®ã‚³ãƒ³ãƒ†ãƒŠã‚¢ã‚¯ã‚»ã‚¹
// - aws ecs execute-command ã‚³ãƒãƒ³ãƒ‰ã®ä½¿ç”¨
```

### Desired Count è¨­å®š ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-021 ã‚ˆã‚Š*

Desired Count ã‚’ 2 ã«è¨­å®šã—ã€ãƒãƒ«ãƒ AZ é…ç½®ã«ã‚ˆã‚‹é«˜å¯ç”¨æ€§ã‚’ç¢ºä¿ã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/ecs-service-construct.ts`

### Service Connect è¨­å®š ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-019 ã‚ˆã‚Š*

Service Connect ã‚’æœ‰åŠ¹åŒ–ã—ã€ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã‚’ç°¡ç´ åŒ–ã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/ecs-service-construct.ts`

```typescript
service.enableServiceConnect({
  namespace: props.namespace,
  services: [{
    portMappingName: 'http',
    dnsName: props.serviceName,
    port: 3000,
  }],
});
```

---

## åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆè¦ä»¶

### Service ä½œæˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-019 ã‚ˆã‚Š*

- FargateService ãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨
- ã‚µãƒ¼ãƒ“ã‚¹åãŒå‘½åè¦å‰‡ã«å¾“ã£ã¦ã„ã‚‹ã“ã¨
- Private Subnet ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã“ã¨

### ECS Exec ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-020 ã‚ˆã‚Š*

- EnableExecuteCommand ãŒ true ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- å¿…è¦ãª IAM æ¨©é™ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã“ã¨

### Desired Count ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-021 ã‚ˆã‚Š*

- DesiredCount ãŒ 2 ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨

### ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

- CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæœŸå¾…é€šã‚Šã«ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ

1. `/tsumiki:tdd-requirements TASK-0015` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 7é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 7é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
