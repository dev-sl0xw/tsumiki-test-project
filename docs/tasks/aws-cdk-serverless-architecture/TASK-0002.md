# TASK-0002: VPC Construct å®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0002
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 8æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1 - åŸºç›¤æ§‹ç¯‰
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ãƒ»è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/aws-cdk-serverless-architecture/requirements.md) - REQ-001, REQ-002, REQ-003, REQ-004, REQ-005, REQ-006, REQ-007
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/aws-cdk-serverless-architecture/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

VPC ã®åŸºæœ¬æ§‹æˆã‚’å®Ÿè£…ã™ã‚‹ Construct ã‚’ä½œæˆã™ã‚‹ã€‚CIDR Block `10.0.0.0/16` ã® VPCã€2ã¤ã®å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³ï¼ˆap-northeast-1a, ap-northeast-1cï¼‰ã§ã® Multi-AZ æ§‹æˆã€Public/Private App/Private DB ã®3å±¤ã‚µãƒ–ãƒãƒƒãƒˆã€Internet Gatewayã€å„ AZ ã¸ã® NAT Gateway é…ç½®ã‚’å«ã‚€ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0001](TASK-0001.md) (CDK ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–)
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: [TASK-0003](TASK-0003.md) (VPC Endpoints Construct å®Ÿè£…), [TASK-0004](TASK-0004.md) (VPC Stack çµ±åˆ)

## å®Œäº†æ¡ä»¶

- [ ] VpcConstruct ã‚¯ãƒ©ã‚¹ãŒ lib/construct/vpc/vpc-construct.ts ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] VPC CIDR ãŒ 10.0.0.0/16 ã§ä½œæˆã•ã‚Œã‚‹
- [ ] 2ã¤ã® AZ (ap-northeast-1a, ap-northeast-1c) ã«ã‚µãƒ–ãƒãƒƒãƒˆãŒé…ç½®ã•ã‚Œã‚‹
- [ ] Public Subnet ãŒ /24 ã§ ALBãƒ»NAT Gateway ç”¨ã«ä½œæˆã•ã‚Œã‚‹
- [ ] Private App Subnet ãŒ /23 ã§ ECS Fargate ç”¨ã«ä½œæˆã•ã‚Œã‚‹
- [ ] Private DB Subnet ãŒ /24 ã§ Aurora ç”¨ã«ä½œæˆã•ã‚Œã‚‹
- [ ] Internet Gateway ãŒ 1å€‹ä½œæˆã•ã‚Œã‚‹
- [ ] NAT Gateway ãŒå„ AZ ã« 1å€‹ãšã¤ï¼ˆè¨ˆ2å€‹ï¼‰ä½œæˆã•ã‚Œã‚‹
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆãŒã™ã¹ã¦æˆåŠŸã™ã‚‹

---

## ä¸»è¦å®Ÿè£…é …ç›®

### VPC ä½œæˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ REQ-001ã‚ˆã‚Š*

CIDR Block `10.0.0.0/16` ã® VPC ã‚’ä½œæˆã™ã‚‹ã€‚

```typescript
const vpc = new ec2.Vpc(this, 'Vpc', {
  ipAddresses: ec2.IpAddresses.cidr('10.0.0.0/16'),
  maxAzs: 2,
  // ...
});
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/vpc/vpc-construct.ts`

---

### Multi-AZ ã‚µãƒ–ãƒãƒƒãƒˆè¨­è¨ˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ REQ-002, REQ-003, REQ-004, REQ-005ã‚ˆã‚Š*

3å±¤ã‚µãƒ–ãƒãƒƒãƒˆæ§‹æˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

| ã‚µãƒ–ãƒãƒƒãƒˆ | CIDR | ç”¨é€” |
|-----------|------|------|
| Public | /24 x 2 | ALB, NAT Gateway |
| Private App | /23 x 2 | ECS Fargate |
| Private DB | /24 x 2 | Aurora |

```typescript
subnetConfiguration: [
  {
    cidrMask: 24,
    name: 'Public',
    subnetType: ec2.SubnetType.PUBLIC,
  },
  {
    cidrMask: 23,
    name: 'PrivateApp',
    subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
  },
  {
    cidrMask: 24,
    name: 'PrivateDb',
    subnetType: ec2.SubnetType.PRIVATE_ISOLATED,
  },
],
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/vpc/vpc-construct.ts`

---

### Internet Gateway ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ REQ-006ã‚ˆã‚Š*

Internet Gateway ã‚’ä½œæˆã—ã€Public Subnet ã‹ã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã™ã‚‹ã€‚CDK ã® Vpc ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã§ã¯ PUBLIC ã‚µãƒ–ãƒãƒƒãƒˆã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã‚‹ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/vpc/vpc-construct.ts`

---

### NAT Gateway ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ REQ-007ã‚ˆã‚Š*

å„ AZ ã« NAT Gateway ã‚’é…ç½®ã—ã€Private Subnet ã‹ã‚‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã™ã‚‹ã€‚

```typescript
natGateways: 2,
natGatewaySubnets: {
  subnetType: ec2.SubnetType.PUBLIC,
},
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/vpc/vpc-construct.ts`

---

## åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆè¦ä»¶

### VPC CIDR ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ REQ-001ã‚ˆã‚Š*

- VPC ã® CIDR Block ãŒ `10.0.0.0/16` ã§ã‚ã‚‹ã“ã¨

### ã‚µãƒ–ãƒãƒƒãƒˆæ§‹æˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ REQ-002ã€œ005ã‚ˆã‚Š*

- Public Subnet ãŒ 2ã¤å­˜åœ¨ã™ã‚‹ã“ã¨
- Private App Subnet ãŒ 2ã¤å­˜åœ¨ã™ã‚‹ã“ã¨
- Private DB Subnet ãŒ 2ã¤å­˜åœ¨ã™ã‚‹ã“ã¨
- å„ã‚µãƒ–ãƒãƒƒãƒˆãŒç•°ãªã‚‹ AZ ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã“ã¨

### Internet Gateway ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ REQ-006ã‚ˆã‚Š*

- Internet Gateway ãŒ 1å€‹ä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- VPC ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã“ã¨

### NAT Gateway ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ REQ-007ã‚ˆã‚Š*

- NAT Gateway ãŒ 2å€‹ä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- å„ Public Subnet ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã“ã¨

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ

1. `/tsumiki:tdd-requirements TASK-0002` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 8é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 8é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
