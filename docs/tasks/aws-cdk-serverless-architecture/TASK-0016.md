# TASK-0016: ALB Construct å®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0016
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 6æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 3 - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *è¦ä»¶å®šç¾©æ›¸ãƒ»è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/aws-cdk-serverless-architecture/requirements.md) - REQ-028, REQ-029, REQ-030
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/aws-cdk-serverless-architecture/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

Application Load Balancer (ALB) Construct ã‚’å®Ÿè£…ã—ã¾ã™ã€‚Internet-facing ALB ã‚’ä½œæˆã—ã€HTTP ã‹ã‚‰ HTTPS ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¨ ACM è¨¼æ˜æ›¸ã«ã‚ˆã‚‹ TLS çµ‚ç«¯ã‚’è¨­å®šã—ã¾ã™ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0015](TASK-0015.md) - ECS Service Construct å®Ÿè£…
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: [TASK-0017](TASK-0017.md) - Application Stack çµ±åˆ

## å®Œäº†æ¡ä»¶

- [ ] ALB Construct ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã‚‹ã“ã¨
- [ ] Internet-facing ã§ Public Subnet ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] HTTP ã‹ã‚‰ HTTPS ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] ACM è¨¼æ˜æ›¸ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒã™ã¹ã¦ãƒ‘ã‚¹ã™ã‚‹ã“ã¨
- [ ] ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨

---

## ä¸»è¦å®Ÿè£…é …ç›®

### Internet-facing ALB ä½œæˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-028 ã‚ˆã‚Š*

Internet-facing ã® Application Load Balancer ã‚’ Public Subnet ã«ä½œæˆã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/alb-construct.ts`

```typescript
import * as elbv2 from 'aws-cdk-lib/aws-elasticloadbalancingv2';

const alb = new elbv2.ApplicationLoadBalancer(this, 'ALB', {
  vpc: props.vpc,
  internetFacing: true,
  vpcSubnets: { subnetType: ec2.SubnetType.PUBLIC },
  securityGroup: props.securityGroup,
  loadBalancerName: `${props.projectName}-alb`,
});
```

### HTTPS ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆè¨­å®š ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-029 ã‚ˆã‚Š*

HTTP (ãƒãƒ¼ãƒˆ80) ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ HTTPS (ãƒãƒ¼ãƒˆ443) ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/alb-construct.ts`

```typescript
alb.addRedirect({
  sourceProtocol: elbv2.ApplicationProtocol.HTTP,
  sourcePort: 80,
  targetProtocol: elbv2.ApplicationProtocol.HTTPS,
  targetPort: 443,
});
```

### ACM è¨¼æ˜æ›¸è¨­å®š ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-030 ã‚ˆã‚Š*

ACM è¨¼æ˜æ›¸ã‚’ä½¿ç”¨ã—ã¦ HTTPS ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã—ã€TLS çµ‚ç«¯ã‚’ ALB ã§è¡Œã„ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/alb-construct.ts`

```typescript
const httpsListener = alb.addListener('HttpsListener', {
  port: 443,
  protocol: elbv2.ApplicationProtocol.HTTPS,
  certificates: [props.certificate],
  sslPolicy: elbv2.SslPolicy.TLS12,
});
```

### ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-028 ã‚ˆã‚Š*

ECS Service ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ã™ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¨­å®šã—ã¾ã™ã€‚ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å«ã¿ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/construct/alb-construct.ts`

```typescript
httpsListener.addTargets('EcsTarget', {
  port: 3000,
  protocol: elbv2.ApplicationProtocol.HTTP,
  targets: [props.ecsService],
  healthCheck: {
    path: '/health',
    interval: cdk.Duration.seconds(30),
    timeout: cdk.Duration.seconds(5),
    healthyThresholdCount: 2,
    unhealthyThresholdCount: 3,
  },
});
```

---

## åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆè¦ä»¶

### ALB ä½œæˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-028 ã‚ˆã‚Š*

- ApplicationLoadBalancer ãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨
- internetFacing ãŒ true ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- Public Subnet ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã“ã¨

### HTTPS ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-029 ã‚ˆã‚Š*

- HTTP ãƒªã‚¹ãƒŠãƒ¼ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆãŒ HTTPS:443 ã§ã‚ã‚‹ã“ã¨

### ACM è¨¼æ˜æ›¸ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-030 ã‚ˆã‚Š*

- HTTPS ãƒªã‚¹ãƒŠãƒ¼ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ACM è¨¼æ˜æ›¸ãŒé–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨
- TLS ãƒãƒªã‚·ãƒ¼ãŒ TLS1.2 ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯é–“éš”ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨

### ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã‚ˆã‚Š*

- CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæœŸå¾…é€šã‚Šã«ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ

1. `/tsumiki:tdd-requirements TASK-0016` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 9é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 9é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
