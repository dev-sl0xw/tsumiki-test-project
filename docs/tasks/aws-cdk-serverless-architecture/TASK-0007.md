# TASK-0007: Security Stack çµ±åˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0007
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *è¨­è¨ˆæ–‡æ›¸ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/aws-cdk-serverless-architecture/requirements.md) - REQ-024, REQ-025, REQ-018
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/aws-cdk-serverless-architecture/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

Phase 1 ã§å€‹åˆ¥ã«å®Ÿè£…ã—ãŸ Security Group Construct ã¨ IAM Role Construct ã‚’ã€çµ±åˆã•ã‚ŒãŸ Security Stack ã¨ã—ã¦æ§‹æˆã—ã¾ã™ã€‚VPC ä¾å­˜é–¢ä¿‚ã®é©åˆ‡ãªç®¡ç†ã€ã‚¹ã‚¿ãƒƒã‚¯é–“ã®ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã€ãŠã‚ˆã³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ãƒªã‚½ãƒ¼ã‚¹ã®ä¸€å…ƒç®¡ç†ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0005](TASK-0005.md) Security Group Construct, [TASK-0006](TASK-0006.md) IAM Role Construct
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: [TASK-0008](TASK-0008.md) Aurora Construct, [TASK-0011](TASK-0011.md) WAF Construct

## å®Œäº†æ¡ä»¶

- [ ] Security Stack ãŒ VPC Stack ã‹ã‚‰ã®ä¾å­˜é–¢ä¿‚ã‚’æ­£ã—ãè§£æ±ºã—ã¦ã„ã‚‹
- [ ] Security Group ã¨ IAM Role ãŒ Security Stack å†…ã§çµ±åˆã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¹ã‚¿ãƒƒã‚¯é–“ã§ã®ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ãŒé©åˆ‡ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹
- [ ] ã™ã¹ã¦ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒé€šéã—ã¦ã„ã‚‹
- [ ] cdk synth ã§ã‚¨ãƒ©ãƒ¼ãªã CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹

---

## ä¸»è¦å®Ÿè£…é …ç›®

### Security Stack å®šç¾© ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *CDK ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹*

Security Group ã¨ IAM Role ã‚’çµ±åˆã—ãŸ Security Stack ã‚’å®Ÿè£…ã—ã¾ã™ã€‚VPC Stack ã‹ã‚‰ã®å‚ç…§ã‚’å—ã‘å–ã‚Šã€ä»–ã®ã‚¹ã‚¿ãƒƒã‚¯ã¸ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```typescript
export interface SecurityStackProps extends cdk.StackProps {
  vpc: ec2.IVpc;
  envName: string;
}

export class SecurityStack extends cdk.Stack {
  public readonly ecsSecurityGroup: ec2.ISecurityGroup;
  public readonly auroraSecurityGroup: ec2.ISecurityGroup;
  public readonly ecsTaskRole: iam.IRole;
  public readonly ecsTaskExecutionRole: iam.IRole;
}
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/stack/security-stack.ts`

### ã‚¹ã‚¿ãƒƒã‚¯é–“ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *CDK ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹*

CfnOutput ã‚’ä½¿ç”¨ã—ãŸã‚¹ã‚¿ãƒƒã‚¯é–“ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã®å®Ÿè£…ã€‚Security Group ARNã€IAM Role ARN ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’è¡Œã„ã¾ã™ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/stack/security-stack.ts`

---

## åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆè¦ä»¶

### Security Stack ç”Ÿæˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *CDK ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³*

- Security Stack ãŒæ­£å¸¸ã«åˆæˆã§ãã‚‹ã“ã¨
- å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ï¼ˆSecurity Groupã€IAM Roleï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨

### ã‚¹ã‚¿ãƒƒã‚¯ä¾å­˜é–¢ä¿‚ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *CDK ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³*

- VPC Stack ã¸ã®ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ

1. `/tsumiki:tdd-requirements TASK-0007` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 4é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 4é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
