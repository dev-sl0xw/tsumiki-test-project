# TASK-0006: IAM Role Construct ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸

**ã‚¿ã‚¹ã‚¯ID**: TASK-0006
**æ©Ÿèƒ½å**: IAM Role Construct for ECS Tasks
**è¦ä»¶å**: aws-cdk-serverless-architecture
**å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å**: `docs/implements/aws-cdk-serverless-architecture/TASK-0006/testcases.md`
**ä½œæˆæ—¥**: 2026-01-18
**ãƒ•ã‚§ãƒ¼ã‚º**: TDD - Testcases Phase

---

## 1. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ¦‚è¦

### 1.1 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå | ã‚«ãƒ†ã‚´ãƒª | ä¿¡é ¼æ€§ |
|----------|----------|----------|--------|
| TC-IAM-01 | ECS Task Role ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ | æ­£å¸¸ç³» | ğŸ”µ |
| TC-IAM-02 | Task Role ã« ecs-tasks.amazonaws.com ãŒ AssumeRole ã§ãã‚‹ã“ã¨ | æ­£å¸¸ç³» | ğŸ”µ |
| TC-IAM-03 | Task Role ã« AmazonSSMManagedInstanceCore ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã“ã¨ | æ­£å¸¸ç³» | ğŸ”µ |
| TC-IAM-04 | Task Role ã« secretsmanager:GetSecretValue æ¨©é™ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ | æ­£å¸¸ç³» | ğŸ”µ |
| TC-IAM-05 | ECS Task Execution Role ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ | æ­£å¸¸ç³» | ğŸ”µ |
| TC-IAM-06 | Execution Role ã« ecs-tasks.amazonaws.com ãŒ AssumeRole ã§ãã‚‹ã“ã¨ | æ­£å¸¸ç³» | ğŸ”µ |
| TC-IAM-07 | Execution Role ã« AmazonECSTaskExecutionRolePolicy ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã“ã¨ | æ­£å¸¸ç³» | ğŸ”µ |
| TC-IAM-08 | ç®¡ç†è€…æ¨©é™ (AdministratorAccess ç­‰) ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ãªã„ã“ã¨ | ç•°å¸¸ç³»/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | ğŸ”µ |
| TC-IAM-09 | å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ (taskRole, executionRole) ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ | æ­£å¸¸ç³» | ğŸ”µ |
| TC-IAM-10 | ä½œæˆã•ã‚Œã‚‹ IAM Role ãŒ 2 ã¤ã§ã‚ã‚‹ã“ã¨ | æ­£å¸¸ç³» | ğŸ”µ |
| TC-IAM-11 | secretArns ã‚’æŒ‡å®šã—ãŸå ´åˆã€ç‰¹å®šã® ARN ã®ã¿ã«ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã•ã‚Œã‚‹ã“ã¨ | æ­£å¸¸ç³»/å¢ƒç•Œå€¤ | ğŸ”µ |
| TC-IAM-12 | secretArns ãŒç©ºé…åˆ—ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ ['*'] ãŒä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ | å¢ƒç•Œå€¤ | ğŸŸ¡ |
| TC-IAM-13 | Props ãŒ undefined ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ Role ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ | å¢ƒç•Œå€¤ | ğŸ”µ |
| TC-IAM-14 | PowerUserAccess ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ãªã„ã“ã¨ | ç•°å¸¸ç³»/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | ğŸ”µ |
| TC-IAM-15 | IAMFullAccess ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ãªã„ã“ã¨ | ç•°å¸¸ç³»/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | ğŸ”µ |

---

## 2. æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### TC-IAM-01: ECS Task Role ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: ECS Task Role ä½œæˆç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: IamRoleConstruct ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ãŸéš›ã«ã€ECS Task Role ãŒæ­£ã—ãä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: AWS::IAM::Role ãƒªã‚½ãƒ¼ã‚¹ãŒ Task Role ç”¨ã«ä½œæˆã•ã‚Œã‚‹

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IAM Role Construct ã‚’ä½œæˆ

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**: AWS::IAM::Role ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã€AssumeRolePolicyDocument ã« ecs-tasks.amazonaws.com ãŒå«ã¾ã‚Œã‚‹
  - **æœŸå¾…çµæœã®ç†ç”±**: ECS Task Role ã¯ ECS Fargate ã‚¿ã‚¹ã‚¯ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ™‚ã«ä½¿ç”¨ã™ã‚‹ãŸã‚å¿…é ˆ

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: IAM Role ã®åŸºæœ¬çš„ãªä½œæˆç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: Role ãƒªã‚½ãƒ¼ã‚¹ãŒ CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ã“ã¨

- ğŸ”µ **ä¿¡é ¼æ€§**: è¦ä»¶å®šç¾©æ›¸ REQ-018ã€ã‚¿ã‚¹ã‚¯å®šç¾© TASK-0006.md ã‚ˆã‚Š

---

### TC-IAM-02: Task Role ã« ecs-tasks.amazonaws.com ãŒ AssumeRole ã§ãã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: Task Role Trust Relationship ç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: Task Role ã® AssumeRolePolicyDocument ã« ecs-tasks.amazonaws.com ãŒä¿¡é ¼ã•ã‚ŒãŸãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¨ã—ã¦å«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: ECS ã‚µãƒ¼ãƒ“ã‚¹ãŒ Task Role ã‚’å¼•ãå—ã‘å¯èƒ½

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IAM Role Construct ã‚’ä½œæˆ

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
  ```json
  {
    "Effect": "Allow",
    "Principal": {
      "Service": "ecs-tasks.amazonaws.com"
    },
    "Action": "sts:AssumeRole"
  }
  ```
  - **æœŸå¾…çµæœã®ç†ç”±**: ECS Fargate ã‚¿ã‚¹ã‚¯ã¯ ecs-tasks.amazonaws.com ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’é€šã˜ã¦ Role ã‚’å¼•ãå—ã‘ã‚‹

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: Trust Relationship ã®æ­£ç¢ºæ€§ç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: AssumeRolePolicyDocument ã® Statement é…åˆ—ã«æ­£ã—ã„ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒå«ã¾ã‚Œã‚‹ã“ã¨

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md Trust Relationship è¨­è¨ˆã‚ˆã‚Š

---

### TC-IAM-03: Task Role ã« AmazonSSMManagedInstanceCore ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: Task Role SSM ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒãƒªã‚·ãƒ¼ç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: Task Role ã« AmazonSSMManagedInstanceCore ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒãƒªã‚·ãƒ¼ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: ECS Exec (SSM Session Manager) ãŒä½¿ç”¨å¯èƒ½

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IAM Role Construct ã‚’ä½œæˆ

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**: ManagedPolicyArns ã« `AmazonSSMManagedInstanceCore` ã¸ã®å‚ç…§ãŒå«ã¾ã‚Œã‚‹
  - **æœŸå¾…çµæœã®ç†ç”±**: REQ-018 ã«åŸºã¥ãã€ECS Exec ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ãŸã‚ã«å¿…é ˆ

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: SSM æ¨©é™ã®ä»˜ä¸ç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒãƒªã‚·ãƒ¼ ARN ãŒæ­£ã—ãå‚ç…§ã•ã‚Œã¦ã„ã‚‹ã“ã¨

- ğŸ”µ **ä¿¡é ¼æ€§**: è¦ä»¶å®šç¾©æ›¸ REQ-018ã€ã‚¿ã‚¹ã‚¯å®šç¾© TASK-0006.md ã‚ˆã‚Š

---

### TC-IAM-04: Task Role ã« secretsmanager:GetSecretValue æ¨©é™ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: Task Role Secrets Manager æ¨©é™ç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: Task Role ã« secretsmanager:GetSecretValue ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨±å¯ã™ã‚‹ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: ECS ã‚¿ã‚¹ã‚¯ã‹ã‚‰ Secrets Manager ã® DB èªè¨¼æƒ…å ±ã‚’å–å¾—å¯èƒ½

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IAM Role Construct ã‚’ä½œæˆï¼ˆsecretArns æœªæŒ‡å®šã§ '*' ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
  ```json
  {
    "Effect": "Allow",
    "Action": ["secretsmanager:GetSecretValue"],
    "Resource": "*"
  }
  ```
  - **æœŸå¾…çµæœã®ç†ç”±**: Aurora èªè¨¼æƒ…å ±ã¯ Secrets Manager ã§ç®¡ç†ã•ã‚Œã€ã‚¿ã‚¹ã‚¯ã‹ã‚‰å–å¾—ãŒå¿…è¦

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: Secrets Manager ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®ç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: PolicyDocument ã« secretsmanager:GetSecretValue ãŒå«ã¾ã‚Œã‚‹ã“ã¨

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯å®šç¾© TASK-0006.md Secrets Manager ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚ˆã‚Š

---

### TC-IAM-05: ECS Task Execution Role ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: ECS Task Execution Role ä½œæˆç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: IamRoleConstruct ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ãŸéš›ã«ã€ECS Task Execution Role ãŒæ­£ã—ãä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: AWS::IAM::Role ãƒªã‚½ãƒ¼ã‚¹ãŒ Execution Role ç”¨ã«ä½œæˆã•ã‚Œã‚‹

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IAM Role Construct ã‚’ä½œæˆ

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**: AWS::IAM::Role ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã€AmazonECSTaskExecutionRolePolicy ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹
  - **æœŸå¾…çµæœã®ç†ç”±**: ECS Task Execution Role ã¯ ECS ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒ ECR Pull ã‚„ CloudWatch Logs æ›¸ãè¾¼ã¿ã«ä½¿ç”¨

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: Execution Role ã®åŸºæœ¬çš„ãªä½œæˆç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: 2 ã¤ç›®ã® Role ãƒªã‚½ãƒ¼ã‚¹ãŒ CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ã“ã¨

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯å®šç¾© TASK-0006.md ECS Task Execution Role ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚ˆã‚Š

---

### TC-IAM-06: Execution Role ã« ecs-tasks.amazonaws.com ãŒ AssumeRole ã§ãã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: Execution Role Trust Relationship ç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: Execution Role ã® AssumeRolePolicyDocument ã« ecs-tasks.amazonaws.com ãŒä¿¡é ¼ã•ã‚ŒãŸãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¨ã—ã¦å«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: ECS ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒ Execution Role ã‚’å¼•ãå—ã‘å¯èƒ½

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IAM Role Construct ã‚’ä½œæˆ

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
  ```json
  {
    "Effect": "Allow",
    "Principal": {
      "Service": "ecs-tasks.amazonaws.com"
    },
    "Action": "sts:AssumeRole"
  }
  ```
  - **æœŸå¾…çµæœã®ç†ç”±**: ECS Task Execution Role ã‚‚ ecs-tasks.amazonaws.com ã‚’ä¿¡é ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: Trust Relationship ã®æ­£ç¢ºæ€§ç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: ä¸¡æ–¹ã® Role ãŒåŒã˜ Trust Relationship ã‚’æŒã¤ã“ã¨

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md Trust Relationship è¨­è¨ˆã‚ˆã‚Š

---

### TC-IAM-07: Execution Role ã« AmazonECSTaskExecutionRolePolicy ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: Execution Role ECS ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒãƒªã‚·ãƒ¼ç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: Execution Role ã« service-role/AmazonECSTaskExecutionRolePolicy ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒãƒªã‚·ãƒ¼ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: ECR ã‹ã‚‰ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ Pull ã¨ CloudWatch Logs ã¸ã®æ›¸ãè¾¼ã¿ãŒå¯èƒ½

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IAM Role Construct ã‚’ä½œæˆ

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**: ManagedPolicyArns ã« `service-role/AmazonECSTaskExecutionRolePolicy` ã¸ã®å‚ç…§ãŒå«ã¾ã‚Œã‚‹
  - **æœŸå¾…çµæœã®ç†ç”±**: ECS Fargate å¿…é ˆã®æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ AWS ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒãƒªã‚·ãƒ¼

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: ECR Pull / CloudWatch Logs æ¨©é™ã®ä»˜ä¸ç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒãƒªã‚·ãƒ¼ ARN ãŒæ­£ã—ãå‚ç…§ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆservice-role/ ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãï¼‰

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯å®šç¾© TASK-0006.md ECS Task Execution Role ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚ˆã‚Š

---

### TC-IAM-09: å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ (taskRole, executionRole) ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: IamRoleConstruct ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® taskRole ã¨ executionRole ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: ä¸¡ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ iam.IRole å‹ã§å®šç¾©ã•ã‚Œã‚‹

- **å…¥åŠ›å€¤**: `const construct = new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IAM Role Construct ã‚’ä½œæˆ

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
  - `construct.taskRole` ãŒ defined
  - `construct.executionRole` ãŒ defined
  - **æœŸå¾…çµæœã®ç†ç”±**: å¾Œç¶šã® Task Definition Construct ãŒã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‚ç…§ã™ã‚‹ãŸã‚å¿…é ˆ

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å…¬é–‹ç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: undefined ã§ãªã„ã“ã¨ã€å‹ãŒæ­£ã—ã„ã“ã¨

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md å‹å®šç¾©ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚ˆã‚Š

---

### TC-IAM-10: ä½œæˆã•ã‚Œã‚‹ IAM Role ãŒ 2 ã¤ã§ã‚ã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: IAM Role ç·æ•°ç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: IamRoleConstruct ã§ä½œæˆã•ã‚Œã‚‹ IAM Role ã®ç·æ•°ãŒ 2 ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: Task Role ã¨ Execution Role ã® 2 ã¤ã®ã¿ãŒä½œæˆã•ã‚Œã‚‹

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IAM Role Construct ã‚’ä½œæˆ

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**: AWS::IAM::Role ãƒªã‚½ãƒ¼ã‚¹ãŒæ­£ç¢ºã« 2 ã¤å­˜åœ¨ã™ã‚‹
  - **æœŸå¾…çµæœã®ç†ç”±**: ä¸è¦ãª Role ãŒä½œæˆã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªï¼ˆæœ€å°æ¨©é™ã®åŸå‰‡ï¼‰

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: ä¸è¦ãƒªã‚½ãƒ¼ã‚¹ã®ä¸åœ¨ç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: resourceCountIs('AWS::IAM::Role', 2)

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ¦‚è¦ TC-IAM-10 ã‚ˆã‚Š

---

### TC-IAM-11: secretArns ã‚’æŒ‡å®šã—ãŸå ´åˆã€ç‰¹å®šã® ARN ã®ã¿ã«ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã•ã‚Œã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: secretArns ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŒ‡å®šç¢ºèª
  - **ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹**: secretArns ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ç‰¹å®šã® Secret ARN ã‚’æŒ‡å®šã—ãŸå ´åˆã€ãã® ARN ã®ã¿ã«ã‚¢ã‚¯ã‚»ã‚¹ãŒåˆ¶é™ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: PolicyStatement ã® Resource ãŒæŒ‡å®šã•ã‚ŒãŸ ARN ã«åˆ¶é™ã•ã‚Œã‚‹

- **å…¥åŠ›å€¤**:
  ```typescript
  new IamRoleConstruct(stack, 'TestIamRoles', {
    secretArns: ['arn:aws:secretsmanager:ap-northeast-1:123456789012:secret:my-db-secret-abc123'],
  })
  ```
  - **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³**: ç‰¹å®šã® Secret ARN ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
  ```json
  {
    "Effect": "Allow",
    "Action": ["secretsmanager:GetSecretValue"],
    "Resource": ["arn:aws:secretsmanager:ap-northeast-1:123456789012:secret:my-db-secret-abc123"]
  }
  ```
  - **æœŸå¾…çµæœã®ç†ç”±**: æœ¬ç•ªç’°å¢ƒã§ã¯ç‰¹å®šã® Secret ã®ã¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã¹ãï¼ˆæœ€å°æ¨©é™ã®åŸå‰‡ï¼‰

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚ˆã‚‹æ¨©é™åˆ¶é™ã®ç¢ºèª
  - **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: Resource ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ '*' ã§ã¯ãªãæŒ‡å®šã•ã‚ŒãŸ ARN ã«ãªã‚‹ã“ã¨

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …ã‚ˆã‚Š

---

## 3. ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰

### TC-IAM-08: ç®¡ç†è€…æ¨©é™ (AdministratorAccess ç­‰) ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ãªã„ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: AdministratorAccess ä¸åœ¨ç¢ºèª
  - **ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®æ¦‚è¦**: åºƒç¯„ãªç®¡ç†è€…æ¨©é™ãŒèª¤ã£ã¦ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
  - **ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®é‡è¦æ€§**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‚’é˜²æ­¢ã€æœ€å°æ¨©é™ã®åŸå‰‡ã‚’éµå®ˆ

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **ä¸æ­£ãªç†ç”±**: AdministratorAccess ã¯ ECS ã‚¿ã‚¹ã‚¯ã«ä¸è¦ã‹ã¤å±é™º
  - **å®Ÿéš›ã®ç™ºç”Ÿã‚·ãƒŠãƒªã‚ª**: é–‹ç™ºæ™‚ã®èª¤è¨­å®šã€ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã«ã‚ˆã‚‹è¨­å®šãƒŸã‚¹

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**: ManagedPolicyArns ã« `AdministratorAccess` ãŒå«ã¾ã‚Œãªã„
  - **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹**: N/Aï¼ˆãƒãƒªã‚·ãƒ¼ãŒå­˜åœ¨ã—ãªã„ã“ã¨ã‚’ç¢ºèªï¼‰
  - **ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§**: æœ€å°æ¨©é™ãŒä¿è¨¼ã•ã‚Œã‚‹

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: éå‰°æ¨©é™ã®æ’é™¤ç¢ºèª
  - **å“è³ªä¿è¨¼ã®è¦³ç‚¹**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã§æŒ‡æ‘˜ã•ã‚Œã‚‹ãƒªã‚¹ã‚¯ã‚’äº‹å‰ã«æ’é™¤

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …ã€ã‚¿ã‚¹ã‚¯å®šç¾© TASK-0006.md ã‚ˆã‚Š

---

### TC-IAM-14: PowerUserAccess ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ãªã„ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: PowerUserAccess ä¸åœ¨ç¢ºèª
  - **ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®æ¦‚è¦**: PowerUserAccess ãƒãƒªã‚·ãƒ¼ãŒèª¤ã£ã¦ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
  - **ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®é‡è¦æ€§**: IAM ä»¥å¤–ã®ã»ã¼å…¨ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **ä¸æ­£ãªç†ç”±**: PowerUserAccess ã¯ ECS ã‚¿ã‚¹ã‚¯ã«ä¸è¦ãªåºƒç¯„ãªæ¨©é™ã‚’ä»˜ä¸
  - **å®Ÿéš›ã®ç™ºç”Ÿã‚·ãƒŠãƒªã‚ª**: æ¨©é™ä¸è¶³æ™‚ã®å®‰æ˜“ãªè§£æ±ºç­–ã¨ã—ã¦èª¤ç”¨

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**: ManagedPolicyArns ã« `PowerUserAccess` ãŒå«ã¾ã‚Œãªã„
  - **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹**: N/Aï¼ˆãƒãƒªã‚·ãƒ¼ãŒå­˜åœ¨ã—ãªã„ã“ã¨ã‚’ç¢ºèªï¼‰
  - **ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§**: æœ€å°æ¨©é™ãŒä¿è¨¼ã•ã‚Œã‚‹

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: éå‰°æ¨©é™ã®æ’é™¤ç¢ºèª
  - **å“è³ªä¿è¨¼ã®è¦³ç‚¹**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®éµå®ˆ

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …ã‚ˆã‚Š

---

### TC-IAM-15: IAMFullAccess ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ãªã„ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: IAMFullAccess ä¸åœ¨ç¢ºèª
  - **ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®æ¦‚è¦**: IAMFullAccess ãƒãƒªã‚·ãƒ¼ãŒèª¤ã£ã¦ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
  - **ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®é‡è¦æ€§**: IAM æ¨©é™ã®ä¸æ­£ãªå¤‰æ›´ã‚’é˜²æ­¢

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **ä¸æ­£ãªç†ç”±**: IAMFullAccess ã¯æ¨©é™æ˜‡æ ¼æ”»æ’ƒã®ãƒªã‚¹ã‚¯ã‚’é«˜ã‚ã‚‹
  - **å®Ÿéš›ã®ç™ºç”Ÿã‚·ãƒŠãƒªã‚ª**: IAM æ“ä½œãŒå¿…è¦ã¨èª¤è§£ã•ã‚ŒãŸå ´åˆã®èª¤è¨­å®š

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**: ManagedPolicyArns ã« `IAMFullAccess` ãŒå«ã¾ã‚Œãªã„
  - **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹**: N/Aï¼ˆãƒãƒªã‚·ãƒ¼ãŒå­˜åœ¨ã—ãªã„ã“ã¨ã‚’ç¢ºèªï¼‰
  - **ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§**: æ¨©é™æ˜‡æ ¼æ”»æ’ƒã‚’é˜²æ­¢

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: å±é™ºæ¨©é™ã®æ’é™¤ç¢ºèª
  - **å“è³ªä¿è¨¼ã®è¦³ç‚¹**: æ·±åˆ»ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã®æ’é™¤

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚ˆã‚Š

---

## 4. å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### TC-IAM-12: secretArns ãŒç©ºé…åˆ—ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ ['*'] ãŒä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: secretArns ç©ºé…åˆ—æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œç¢ºèª
  - **å¢ƒç•Œå€¤ã®æ„å‘³**: secretArns ã«ç©ºé…åˆ—ã‚’æ¸¡ã—ãŸå ´åˆã®å‹•ä½œã‚’ç¢ºèª
  - **å¢ƒç•Œå€¤ã§ã®å‹•ä½œä¿è¨¼**: ç©ºé…åˆ—ã§ã‚‚æ­£å¸¸ã«å‹•ä½œã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒé©ç”¨ã•ã‚Œã‚‹

- **å…¥åŠ›å€¤**:
  ```typescript
  new IamRoleConstruct(stack, 'TestIamRoles', {
    secretArns: [],
  })
  ```
  - **å¢ƒç•Œå€¤é¸æŠã®æ ¹æ‹ **: ç©ºé…åˆ—ã¯ã€ŒæŒ‡å®šãªã—ã€ã¨åŒç­‰ã«æ‰±ã‚ã‚Œã‚‹ã¹ã
  - **å®Ÿéš›ã®ä½¿ç”¨å ´é¢**: å‹•çš„ã« ARN ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆã—ã€çµæœãŒç©ºã®å ´åˆ

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**: Resource ãŒ '*' ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  - **å¢ƒç•Œã§ã®æ­£ç¢ºæ€§**: ç©ºé…åˆ—ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦å‡¦ç†
  - **ä¸€è²«ã—ãŸå‹•ä½œ**: undefined ã¨åŒæ§˜ã®çµæœ

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®å‹•ä½œç¢ºèª
  - **å …ç‰¢æ€§ã®ç¢ºèª**: ç©ºé…åˆ—ã§ã‚‚ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„

- ğŸŸ¡ **ä¿¡é ¼æ€§**: è¦ä»¶å®šç¾©æ›¸ requirements.md ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ EC-01 ã‚ˆã‚Šï¼ˆå¦¥å½“ãªæ¨æ¸¬ã‚’å«ã‚€ï¼‰

---

### TC-IAM-13: Props ãŒ undefined ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ Role ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨

- **ãƒ†ã‚¹ãƒˆå**: Props çœç•¥æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œç¢ºèª
  - **å¢ƒç•Œå€¤ã®æ„å‘³**: Props ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç©ºã§æ¸¡ã—ãŸå ´åˆï¼ˆsecretArns æœªæŒ‡å®šï¼‰ã®å‹•ä½œã‚’ç¢ºèª
  - **å¢ƒç•Œå€¤ã§ã®å‹•ä½œä¿è¨¼**: Props çœç•¥ã§ã‚‚æ­£å¸¸ã«å‹•ä½œ

- **å…¥åŠ›å€¤**: `new IamRoleConstruct(stack, 'TestIamRoles', {})`
  - **å¢ƒç•Œå€¤é¸æŠã®æ ¹æ‹ **: æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
  - **å®Ÿéš›ã®ä½¿ç”¨å ´é¢**: é–‹ç™ºç’°å¢ƒã§ã®ç°¡æ˜“çš„ãªä½¿ç”¨

- **æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
  - Task Role ãŒä½œæˆã•ã‚Œã‚‹
  - Execution Role ãŒä½œæˆã•ã‚Œã‚‹
  - secretsmanager:GetSecretValue ã® Resource ãŒ '*'
  - **å¢ƒç•Œã§ã®æ­£ç¢ºæ€§**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒæ­£ã—ãé©ç”¨ã•ã‚Œã‚‹
  - **ä¸€è²«ã—ãŸå‹•ä½œ**: æ˜ç¤ºçš„ãªæŒ‡å®šã¨åŒã˜å‹•ä½œ

- **ãƒ†ã‚¹ãƒˆã®ç›®çš„**: æœ€å°è¨­å®šã§ã®å‹•ä½œç¢ºèª
  - **å …ç‰¢æ€§ã®ç¢ºèª**: Props çœç•¥ã§ã‚‚æœŸå¾…é€šã‚Šã«å‹•ä½œ

- ğŸ”µ **ä¿¡é ¼æ€§**: è¦ä»¶å®šç¾©æ›¸ requirements.md ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ EC-03 ã‚ˆã‚Š

---

## 5. é–‹ç™ºè¨€èªãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

- **ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª**: TypeScript (~5.6.3)
  - **è¨€èªé¸æŠã®ç†ç”±**: AWS CDK v2 ã®å…¬å¼ã‚µãƒãƒ¼ãƒˆè¨€èªã€å‹å®‰å…¨æ€§ã®ç¢ºä¿
  - **ãƒ†ã‚¹ãƒˆã«é©ã—ãŸæ©Ÿèƒ½**: é™çš„å‹ä»˜ã‘ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©

- **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Jest (^29.7.0)
  - **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯é¸æŠã®ç†ç”±**: AWS CDK å…¬å¼æ¨å¥¨ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ—¢å­˜ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã¨ã®æ•´åˆæ€§
  - **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ**: Node.js (ES2018 Target)

- **CDK ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**: aws-cdk-lib/assertions
  - **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é¸æŠã®ç†ç”±**: CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ§‹é€ çš„ãªæ¤œè¨¼ãŒå¯èƒ½
  - **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**: Template.fromStack(), hasResourceProperties(), Match.arrayWith()

- ğŸ”µ **ä¿¡é ¼æ€§**: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã€æ—¢å­˜ãƒ†ã‚¹ãƒˆ security-group-construct.test.ts ã‚ˆã‚Š

---

## 6. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè£…æ™‚ã®æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆæŒ‡é‡

### 6.1 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹é–‹å§‹æ™‚ã®ã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
// ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ECS Task Role ãŒæ­£ã—ãä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
// ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: IamRoleConstruct ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€Task Role ã‚’æ¤œè¨¼
// ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: AWS::IAM::Role ãƒªã‚½ãƒ¼ã‚¹ãŒ Task Role ç”¨ã«ä½œæˆã•ã‚Œã‚‹
// ğŸ”µ ä¿¡é ¼æ€§: è¦ä»¶å®šç¾©æ›¸ REQ-018ã€TASK-0006.md ã‚ˆã‚Š
```

### 6.2 Givenï¼ˆæº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºï¼‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
// ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: CDK App ã¨ Stack ã‚’ä½œæˆ
// ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IamRoleConstruct ã‚’ä½œæˆ
// ã€å‰ææ¡ä»¶ç¢ºèªã€‘: æœ‰åŠ¹ãª Stack ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒå­˜åœ¨ã™ã‚‹
```

### 6.3 Whenï¼ˆå®Ÿè¡Œãƒ•ã‚§ãƒ¼ã‚ºï¼‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
// ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: IamRoleConstruct ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
// ã€å‡¦ç†å†…å®¹ã€‘: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å†…ã§ IAM Role 2 ã¤ã‚’ä½œæˆ
// ã€å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‘: Stack ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚ºæ™‚ã« CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹
```

### 6.4 Thenï¼ˆæ¤œè¨¼ãƒ•ã‚§ãƒ¼ã‚ºï¼‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
// ã€çµæœæ¤œè¨¼ã€‘: CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã« IAM Role ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
// ã€æœŸå¾…å€¤ç¢ºèªã€‘: AssumeRolePolicyDocument ã« ecs-tasks.amazonaws.com ãŒå«ã¾ã‚Œã‚‹
// ã€å“è³ªä¿è¨¼ã€‘: ECS Fargate ã‚¿ã‚¹ã‚¯ãŒ Role ã‚’å¼•ãå—ã‘ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼
```

### 6.5 å„ expect ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®ã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
// ã€æ¤œè¨¼é …ç›®ã€‘: Task Role ã® Trust Relationship ç¢ºèª
// ğŸ”µ ä¿¡é ¼æ€§: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md ã‚ˆã‚Š
template.hasResourceProperties('AWS::IAM::Role', {
  AssumeRolePolicyDocument: Match.objectLike({
    Statement: Match.arrayWith([
      Match.objectLike({
        Effect: 'Allow',
        Principal: { Service: 'ecs-tasks.amazonaws.com' },
        Action: 'sts:AssumeRole',
      }),
    ]),
  }),
}); // ã€ç¢ºèªå†…å®¹ã€‘: ECS Task Role ãŒ ecs-tasks.amazonaws.com ã‚’ä¿¡é ¼ã—ã¦ã„ã‚‹
```

### 6.6 ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã®ã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
beforeEach(() => {
  // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«æ–°ã—ã„ CDK App ã¨ Stack ã‚’ä½œæˆ
  // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: å‰ã®ãƒ†ã‚¹ãƒˆã®çŠ¶æ…‹ãŒå½±éŸ¿ã—ãªã„ã‚ˆã†ã€æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
  app = new cdk.App();
  stack = new cdk.Stack(app, 'TestStack');
});

afterEach(() => {
  // ã€ãƒ†ã‚¹ãƒˆå¾Œå‡¦ç†ã€‘: æ˜ç¤ºçš„ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¯ä¸è¦
  // ã€çŠ¶æ…‹å¾©å…ƒã€‘: Jest ãŒè‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆé–“ã®åˆ†é›¢ã‚’ä¿è¨¼
});
```

---

## 7. è¦ä»¶å®šç¾©ã¨ã®å¯¾å¿œé–¢ä¿‚

### 7.1 å‚ç…§ã—ãŸæ©Ÿèƒ½æ¦‚è¦

- **è¦ä»¶å®šç¾©æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 1.1**: ECS Fargate ã‚¿ã‚¹ã‚¯ã® IAM Role ä½œæˆ
- **ã‚¿ã‚¹ã‚¯å®šç¾© TASK-0006.md**: ã‚¿ã‚¹ã‚¯æ¦‚è¦ã€ä¸»è¦å®Ÿè£…é …ç›®

### 7.2 å‚ç…§ã—ãŸå…¥åŠ›ãƒ»å‡ºåŠ›ä»•æ§˜

- **è¦ä»¶å®šç¾©æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 2**: IamRoleConstructProps ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
- **ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 4**: å‹å®šç¾©ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### 7.3 å‚ç…§ã—ãŸåˆ¶ç´„æ¡ä»¶

- **è¦ä»¶å®šç¾©æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 3**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ¶ç´„ã€IAM Role å›ºæœ‰ã®åˆ¶ç´„
- **NFR-101ã€œ105**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 7.4 å‚ç…§ã—ãŸä½¿ç”¨ä¾‹

- **è¦ä»¶å®šç¾©æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 4**: åŸºæœ¬çš„ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
- **ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ note.md ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 3**: IAM Role ä½œæˆãƒ‘ã‚¿ãƒ¼ãƒ³

---

## 8. ãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«

### 8.1 åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆæ§‹é€ 

```typescript
/**
 * IAM Role Construct ãƒ†ã‚¹ãƒˆ
 *
 * TASK-0006: IAM Role Construct å®Ÿè£…
 * ãƒ•ã‚§ãƒ¼ã‚º: TDD Red Phase - å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä½œæˆ
 *
 * ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
 * - TC-IAM-01: ECS Task Role ä½œæˆç¢ºèª
 * - TC-IAM-02: Task Role Trust Relationship ç¢ºèª
 * - TC-IAM-03: Task Role SSM ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒãƒªã‚·ãƒ¼ç¢ºèª
 * - TC-IAM-04: Task Role Secrets Manager æ¨©é™ç¢ºèª
 * - TC-IAM-05: ECS Task Execution Role ä½œæˆç¢ºèª
 * - TC-IAM-06: Execution Role Trust Relationship ç¢ºèª
 * - TC-IAM-07: Execution Role ECS ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒãƒªã‚·ãƒ¼ç¢ºèª
 * - TC-IAM-08: AdministratorAccess ä¸åœ¨ç¢ºèª
 * - TC-IAM-09: å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª
 * - TC-IAM-10: IAM Role ç·æ•°ç¢ºèª
 * - TC-IAM-11: secretArns ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŒ‡å®šç¢ºèª
 * - TC-IAM-12: secretArns ç©ºé…åˆ—æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œç¢ºèª
 * - TC-IAM-13: Props çœç•¥æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œç¢ºèª
 * - TC-IAM-14: PowerUserAccess ä¸åœ¨ç¢ºèª
 * - TC-IAM-15: IAMFullAccess ä¸åœ¨ç¢ºèª
 *
 * ğŸ”µ ä¿¡é ¼æ€§: è¦ä»¶å®šç¾©æ›¸ REQ-018, ã‚¿ã‚¹ã‚¯å®šç¾© TASK-0006.md ã«åŸºã¥ããƒ†ã‚¹ãƒˆ
 */

import * as cdk from 'aws-cdk-lib';
import { Template, Match } from 'aws-cdk-lib/assertions';
import { IamRoleConstruct } from '../../../lib/construct/security/iam-role-construct';

describe('IamRoleConstruct', () => {
  // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆã§ç‹¬ç«‹ã—ãŸ CDK App ã¨ Stack ã‚’ä½œæˆ
  // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: å‰ã®ãƒ†ã‚¹ãƒˆã®çŠ¶æ…‹ãŒå½±éŸ¿ã—ãªã„ã‚ˆã†ã€æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
  let app: cdk.App;
  let stack: cdk.Stack;
  let iamRoleConstruct: IamRoleConstruct;
  let template: Template;

  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: CDK App ã¨ Stack ã‚’ä½œæˆ
    // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ IamRoleConstruct ã‚’ä½œæˆ
    app = new cdk.App();
    stack = new cdk.Stack(app, 'TestStack', {
      env: {
        account: '123456789012',
        region: 'ap-northeast-1',
      },
    });
  });

  afterEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå¾Œå‡¦ç†ã€‘: æ˜ç¤ºçš„ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¯ä¸è¦
    // ã€çŠ¶æ…‹å¾©å…ƒã€‘: Jest ãŒè‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆé–“ã®åˆ†é›¢ã‚’ä¿è¨¼
  });

  // ============================================================================
  // TC-IAM-01: ECS Task Role ä½œæˆç¢ºèª
  // ğŸ”µ ä¿¡é ¼æ€§: è¦ä»¶å®šç¾©æ›¸ REQ-018 ã‚ˆã‚Š
  // ============================================================================
  describe('TC-IAM-01: ECS Task Role ä½œæˆç¢ºèª', () => {
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…...
  });

  // ... ä»–ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
});
```

---

## 9. ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

### é …ç›®åˆ¥ä¿¡é ¼æ€§

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ä¿¡å· | ğŸŸ¡ é»„ä¿¡å· | ğŸ”´ èµ¤ä¿¡å· |
|---------|----------|----------|----------|
| æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ | 10 | 0 | 0 |
| ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ | 3 | 0 | 0 |
| å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ | 1 | 1 | 0 |
| æŠ€è¡“é¸æŠ | 1 | 0 | 0 |
| **åˆè¨ˆ** | **15** | **1** | **0** |

### ä¿¡é ¼æ€§åˆ†å¸ƒ

- ğŸ”µ **é’ä¿¡å·**: 15é …ç›® (94%)
- ğŸŸ¡ **é»„ä¿¡å·**: 1é …ç›® (6%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

---

## 10. å“è³ªè©•ä¾¡

### è©•ä¾¡åŸºæº–ãƒã‚§ãƒƒã‚¯

| åŸºæº– | è©•ä¾¡ | è©³ç´° |
|------|------|------|
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹åˆ†é¡ | âœ… ç¶²ç¾… | æ­£å¸¸ç³» 10 ä»¶ã€ç•°å¸¸ç³» 3 ä»¶ã€å¢ƒç•Œå€¤ 2 ä»¶ |
| æœŸå¾…å€¤å®šç¾© | âœ… æ˜ç¢º | å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«å…·ä½“çš„ãªæœŸå¾…å€¤ã‚’è¨˜è¼‰ |
| æŠ€è¡“é¸æŠ | âœ… ç¢ºå®š | TypeScript + Jest + aws-cdk-lib/assertions |
| å®Ÿè£…å¯èƒ½æ€§ | âœ… ç¢ºå®Ÿ | æ—¢å­˜ã® security-group-construct.test.ts ã¨åŒæ§˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ |
| ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ« | âœ… é’å¤šæ•° | 94% ãŒé’ä¿¡å· |

### ç·åˆè©•ä¾¡

**âœ… é«˜å“è³ª** - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒç¶²ç¾…çš„ã§ã€æœŸå¾…å€¤ãŒæ˜ç¢ºã€æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®æ•´åˆæ€§ã‚ã‚Š

---

## 11. é–¢é€£æ–‡æ›¸ãƒªãƒ³ã‚¯

| æ–‡æ›¸ | ãƒ‘ã‚¹ |
|------|------|
| ã‚¿ã‚¹ã‚¯å®šç¾© | `docs/tasks/aws-cdk-serverless-architecture/TASK-0006.md` |
| ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ | `docs/implements/aws-cdk-serverless-architecture/TASK-0006/note.md` |
| è¦ä»¶å®šç¾©æ›¸ | `docs/implements/aws-cdk-serverless-architecture/TASK-0006/requirements.md` |
| è¦ä»¶å®šç¾©æ›¸ï¼ˆä»•æ§˜ï¼‰ | `docs/spec/aws-cdk-serverless-architecture/requirements.md` |
| Security Group ãƒ†ã‚¹ãƒˆï¼ˆå‚è€ƒï¼‰ | `infra/test/construct/security/security-group-construct.test.ts` |
| Security Group å®Ÿè£…ï¼ˆå‚è€ƒï¼‰ | `infra/lib/construct/security/security-group-construct.ts` |

---

## 12. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸ã«åŸºã¥ã„ã¦ã€ä»¥ä¸‹ã®æ‰‹é †ã§ TDD ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚

1. **Red Phase**: `/tsumiki:tdd-red aws-cdk-serverless-architecture TASK-0006` ã§å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ
2. **Green Phase**: `/tsumiki:tdd-green aws-cdk-serverless-architecture TASK-0006` ã§æœ€å°é™ã®å®Ÿè£…
3. **Refactor Phase**: `/tsumiki:tdd-refactor aws-cdk-serverless-architecture TASK-0006` ã§ã‚³ãƒ¼ãƒ‰å“è³ªæ”¹å–„
4. **Verify Complete**: `/tsumiki:tdd-verify-complete aws-cdk-serverless-architecture TASK-0006` ã§å®Œäº†ç¢ºèª
