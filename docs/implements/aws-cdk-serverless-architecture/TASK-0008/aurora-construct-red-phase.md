# TDD Red Phase è¨˜éŒ²: Aurora Construct å®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0008
**ã‚¿ã‚¹ã‚¯å**: Aurora Construct å®Ÿè£…
**è¦ä»¶å**: aws-cdk-serverless-architecture
**ãƒ•ã‚§ãƒ¼ã‚º**: Red Phaseï¼ˆå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆä½œæˆï¼‰
**ä½œæˆæ—¥**: 2026-01-19

---

## 1. æ¦‚è¦

Aurora Serverless v2 MySQL ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ CDK Construct ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ä½œæˆã—ã€ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

---

## 2. ä½œæˆã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§

### 2.1 æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆTC-AU-01 ã€œ TC-AU-13ï¼‰

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå | é–¢é€£è¦ä»¶ | ä¿¡é ¼æ€§ |
|----------|----------|----------|--------|
| TC-AU-01 | Aurora Serverless v2 ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒªã‚½ãƒ¼ã‚¹ä½œæˆç¢ºèª | REQ-022 | ğŸ”µ |
| TC-AU-02 | ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ MySQL 8.0 ç¢ºèª | REQ-022 | ğŸ”µ |
| TC-AU-03 | ACU è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ min=0.5, max=2ï¼‰ç¢ºèª | REQ-022 | ğŸ”µ |
| TC-AU-04 | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æš—å·åŒ–æœ‰åŠ¹ç¢ºèª | REQ-026 | ğŸ”µ |
| TC-AU-05 | KMS ã‚­ãƒ¼é–¢é€£ä»˜ã‘ç¢ºèª | REQ-026 | ğŸŸ¡ |
| TC-AU-06 | è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æœ‰åŠ¹ç¢ºèª | REQ-027 | ğŸ”µ |
| TC-AU-07 | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿æŒæœŸé–“ 7 æ—¥é–“ç¢ºèª | REQ-027 | ğŸŸ¡ |
| TC-AU-08 | Security Group é–¢é€£ä»˜ã‘ç¢ºèª | REQ-024, REQ-025 | ğŸ”µ |
| TC-AU-09 | Private Isolated Subnet é…ç½®ç¢ºèª | REQ-023 | ğŸ”µ |
| TC-AU-10 | Secrets Manager ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆä½œæˆç¢ºèª | - | ğŸ”µ |
| TC-AU-11 | ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå…¬é–‹ç¢ºèª | dataflow.md | ğŸ”µ |
| TC-AU-12 | ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ç„¡åŠ¹ç¢ºèª | REQ-024 | ğŸ”µ |
| TC-AU-13 | ãƒãƒ«ãƒ AZ æ§‹æˆç¢ºèª | REQ-023 | ğŸ”µ |

### 2.2 ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆTC-AU-14 ã€œ TC-AU-17ï¼‰

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå | ä¿¡é ¼æ€§ |
|----------|----------|--------|
| TC-AU-14 | ã‚«ã‚¹ã‚¿ãƒ  ACU è¨­å®šåæ˜ ç¢ºèª | ğŸŸ¡ |
| TC-AU-15 | ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åè¨­å®šç¢ºèª | ğŸŸ¡ |
| TC-AU-16 | ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿æŒæœŸé–“è¨­å®šç¢ºèª | ğŸŸ¡ |
| TC-AU-17 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤å‹•ä½œç¢ºèª | ğŸ”µ |

### 2.3 ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆTC-AU-18 ã€œ TC-AU-20ï¼‰

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå | ä¿¡é ¼æ€§ |
|----------|----------|--------|
| TC-AU-18 | æœ€å° ACU å€¤ï¼ˆ0.5ï¼‰å‹•ä½œç¢ºèª | ğŸŸ¡ |
| TC-AU-19 | åŒä¸€ ACU å€¤ï¼ˆmin=maxï¼‰å‹•ä½œç¢ºèª | ğŸŸ¡ |
| TC-AU-20 | é•·ã„ç’°å¢ƒåã§ã®ãƒªã‚½ãƒ¼ã‚¹åç”Ÿæˆç¢ºèª | ğŸ”´ |

### 2.4 å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆTC-AU-21 ã€œ TC-AU-24ï¼‰

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå | ä¿¡é ¼æ€§ |
|----------|----------|--------|
| TC-AU-21 | cluster ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª | ğŸ”µ |
| TC-AU-22 | clusterEndpoint ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª | ğŸ”µ |
| TC-AU-23 | secret ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª | ğŸ”µ |
| TC-AU-24 | securityGroup ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ç¢ºèª | ğŸ”µ |

---

## 3. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

### 3.1 ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹

`infra/test/construct/database/aurora-construct.test.ts`

### 3.2 ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰æ§‹é€ 

```typescript
describe('AuroraConstruct', () => {
  // ãƒ†ã‚¹ãƒˆå‰æº–å‚™ï¼ˆVPCã€Security Group ã®ãƒ¢ãƒƒã‚¯ä½œæˆï¼‰

  describe('æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹', () => {
    // TC-AU-01 ã€œ TC-AU-13
  });

  describe('ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹', () => {
    // TC-AU-14 ã€œ TC-AU-17
  });

  describe('ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹', () => {
    // TC-AU-18 ã€œ TC-AU-20
  });

  describe('å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹', () => {
    // TC-AU-21 ã€œ TC-AU-24
  });
});
```

---

## 4. ã‚¹ã‚¿ãƒ–å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

### 4.1 ã‚¹ã‚¿ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹

`infra/lib/construct/database/aurora-construct.ts`

### 4.2 ã‚¹ã‚¿ãƒ–å®Ÿè£…æ¦‚è¦

- `AuroraConstructProps` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ï¼ˆProps ã®å‹å®šç¾©ï¼‰
- `AuroraConstruct` ã‚¯ãƒ©ã‚¹å®šç¾©ï¼ˆç©ºã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼‰
- å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å®£è¨€ï¼ˆæœªåˆæœŸåŒ–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰

---

## 5. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ

### 5.1 å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
cd /Volumes/data/aws-workspace/tsumiki-test-project/infra
npm test -- --testPathPattern="aurora-construct"
```

### 5.2 çµæœã‚µãƒãƒªãƒ¼

- **ãƒ†ã‚¹ãƒˆç·æ•°**: 32 ãƒ†ã‚¹ãƒˆ
- **å¤±æ•—**: 32 ãƒ†ã‚¹ãƒˆ
- **æˆåŠŸ**: 0 ãƒ†ã‚¹ãƒˆ
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Red Phase æˆåŠŸï¼ˆå…¨ãƒ†ã‚¹ãƒˆãŒæœŸå¾…é€šã‚Šã«å¤±æ•—ï¼‰

### 5.3 æœŸå¾…ã•ã‚Œã‚‹å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹

```
âœ• AWS::RDS::DBCluster ãƒªã‚½ãƒ¼ã‚¹ãŒ 1 ã¤ä½œæˆã•ã‚Œã‚‹ã“ã¨
  Expected 1 resources of type AWS::RDS::DBCluster but found 0

âœ• Engine ãŒ aurora-mysql ã§ã‚ã‚‹ã“ã¨
  Template has 0 resources with type AWS::RDS::DBCluster.
  No matches found

âœ• cluster ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨
  Expected: defined
  Received: undefined
```

---

## 6. Green ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ã™ã¹ãå†…å®¹

### 6.1 Aurora ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä½œæˆ

- `rds.DatabaseCluster` ã‚’ä½¿ç”¨ã—ã¦ Aurora Serverless v2 ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½œæˆ
- ã‚¨ãƒ³ã‚¸ãƒ³: Aurora MySQL 3.xï¼ˆMySQL 8.0 äº’æ›ï¼‰
- Serverless v2 ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®š

### 6.2 ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®š

- MinCapacity: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 0.5 ACU
- MaxCapacity: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 2 ACU
- ã‚«ã‚¹ã‚¿ãƒ å€¤ã®ã‚µãƒãƒ¼ãƒˆ

### 6.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æš—å·åŒ–: `storageEncrypted: true`
- KMS ã‚­ãƒ¼é–¢é€£ä»˜ã‘
- Security Group è¨­å®š
- ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ç„¡åŠ¹

### 6.4 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š

- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æœ‰åŠ¹åŒ–
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿æŒæœŸé–“: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 7 æ—¥

### 6.5 ã‚µãƒ–ãƒãƒƒãƒˆãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š

- DB ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
- Private Isolated Subnet ã¸ã®é…ç½®
- ãƒãƒ«ãƒ AZ æ§‹æˆ

### 6.6 èªè¨¼æƒ…å ±ç®¡ç†

- Secrets Manager ã§ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆ
- `rds.Credentials.fromGeneratedSecret()` ã®ä½¿ç”¨

### 6.7 å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

- `cluster`: DatabaseCluster ãƒªã‚½ãƒ¼ã‚¹ã¸ã®å‚ç…§
- `clusterEndpoint`: Writer ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- `secret`: Secrets Manager ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
- `securityGroup`: é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸ Security Group

---

## 7. ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

| ãƒ¬ãƒ™ãƒ« | ä»¶æ•° | å‰²åˆ |
|--------|------|------|
| ğŸ”µ é’ä¿¡å· | 17 | 71% |
| ğŸŸ¡ é»„ä¿¡å· | 7 | 29% |
| ğŸ”´ èµ¤ä¿¡å· | 1 | 4% |

---

## 8. å“è³ªè©•ä¾¡

### è©•ä¾¡çµæœ: âœ… é«˜å“è³ª

- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: æˆåŠŸï¼ˆå…¨32ãƒ†ã‚¹ãƒˆãŒæœŸå¾…é€šã‚Šã«å¤±æ•—ï¼‰
- **æœŸå¾…å€¤**: æ˜ç¢ºã§å…·ä½“çš„
- **ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³**: CDK assertions ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã€é©åˆ‡ã«è¨­å®š
- **å®Ÿè£…æ–¹é‡**: æ˜ç¢ºï¼ˆGreen ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ã™ã¹ãå†…å®¹ãŒç‰¹å®šæ¸ˆã¿ï¼‰
- **ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µï¼ˆé’ä¿¡å·ï¼‰ãŒ 71% ã§è¦ä»¶å®šç¾©æ›¸ã«åŸºã¥ãç¢ºå®Ÿãªè¨­è¨ˆ

---

## 9. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

`/tsumiki:tdd-green` ã‚³ãƒãƒ³ãƒ‰ã§ Green ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆæœ€å°å®Ÿè£…ï¼‰ã‚’é–‹å§‹ã—ã¾ã™ã€‚

---

## é–¢é€£æ–‡æ›¸

- **ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ**: `docs/implements/aws-cdk-serverless-architecture/TASK-0008/note.md`
- **è¦ä»¶å®šç¾©**: `docs/implements/aws-cdk-serverless-architecture/TASK-0008/requirements.md`
- **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©**: `docs/implements/aws-cdk-serverless-architecture/TASK-0008/testcases.md`
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `infra/test/construct/database/aurora-construct.test.ts`
- **ã‚¹ã‚¿ãƒ–å®Ÿè£…**: `infra/lib/construct/database/aurora-construct.ts`
